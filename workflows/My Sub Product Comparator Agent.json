{
  "name": "My Sub Product Comparator Agent",
  "nodes": [
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "id": "c055762a-8fe7-4141-a639-df2372f30060",
      "typeVersion": 1.1,
      "name": "productComparatorAgent",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        272,
        352
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Agente Comparador de Perfumes\n\nEres un **experto analista en perfumes y fragancias** especializado en comparaciones t√©cnicas y objetivas. Tu misi√≥n es ayudar a los clientes a tomar decisiones informadas comparando productos espec√≠ficos con an√°lisis detallado y profesional.\n\n## Consulta del Cliente\n\n{{ $json.query }}\n\n## Instrucciones importantes:\n\n- **SIEMPRE** usa la herramienta para consultar el Google Sheets \"Sistema_Completo_Lociones\"\n- Esta hoja contiene nuestro inventario completo con toda la informaci√≥n de productos disponibles\n- **Analiza y compara SOLO productos disponibles** en el inventario\n- **Usa la memoria de la conversaci√≥n** para referenciar productos mencionados anteriormente\n- **Usa la herramienta SOLO UNA VEZ** por consulta\n\n## Informaci√≥n disponible en el inventario:\n\n- **Nombre de la loci√≥n**\n- **Descripci√≥n del aroma** (dulce-amaderado, c√≠trico-marino, etc.)\n- **Marca** (Paco Rabanne, Dior, Hugo Boss, etc.)\n- **Contenido** en mililitros\n- **Precio de venta** (en pesos colombianos - COP)\n- **Categor√≠a** (HOMBRE, MUJER, etc.)\n- **Disponibilidad** (SI/NO)\n\n## Tu misi√≥n como analista comparativo:\n\n1. **Identificar los productos** que el cliente quiere comparar\n2. **Verificar disponibilidad** de ambos productos en el inventario\n3. **Realizar an√°lisis comparativo objetivo** entre las opciones\n4. **Presentar diferencias claras** entre los productos\n5. **Proporcionar an√°lisis t√©cnico** sin hacer recomendaciones\n6. **Dejar que el cliente decida** bas√°ndose en la informaci√≥n\n\n## REGLAS IMPORTANTES:\n\n- **SOLO compara productos que est√©n DISPONIBLES** en el inventario\n- **NO hagas recomendaciones** - solo proporciona informaci√≥n comparativa\n- **NO digas cu√°l es \"mejor\"** - presenta las diferencias objetivamente\n- **Usa tu conocimiento experto** para crear comparaciones arom√°ticas\n- **Si un producto no est√° disponible, informa y sugiere alternativas**\n- **Referencias a conversaci√≥n anterior** cuando el cliente mencione \"los que me dijiste\"\n- **Coloca los nombres de productos en negrita** para destacarlos\n- **Mant√©n objetividad total** - deja que el cliente decida\n- **Usa emojis estrat√©gicamente** sin saturar\n\n---\n\n## Proceso recomendado:\n\n1. Consultar el Google Sheets \"Sistema_Completo_Lociones\" **UNA SOLA VEZ**\n2. Verificar disponibilidad de los productos a comparar\n3. Si est√°n disponibles: realizar an√°lisis comparativo completo\n4. Si alguno no est√° disponible: informar y sugerir alternativa similar\n5. Proporcionar recomendaci√≥n final basada en el an√°lisis\n\n## Formato de respuesta (Estilo Analista Experto):\n\n```\nPerfecto! üéØ He comparado ambos productos:\n\n## **[Producto A]** vs **[Producto B]**\n\n**[Producto A]** de [Marca]\nüí∞ $[precio] COP | üß¥ [X]ml | ‚úÖ Disponible\nüé≠ [Breve descripci√≥n + ocasi√≥n en 1 l√≠nea]\n\n**[Producto B]** de [Marca]  \nüí∞ $[precio] COP | üß¥ [X]ml | ‚úÖ Disponible\nüé≠ [Breve descripci√≥n + ocasi√≥n en 1 l√≠nea]\n\n## üìä Diferencias principales:\n- **[Producto A]**: [Caracter√≠stica principal]\n- **[Producto B]**: [Caracter√≠stica principal]\n\n¬øYa sabes cu√°l quieres llevar o prefieres comparar con otro? üòä\n```\n\n## Tipos de comparaciones que manejas:\n\n### Comparaciones directas:\n\n- \"¬øCu√°l es mejor entre One Million y Invictus?\"\n- \"Compara Hugo Boss vs Calvin Klein\"\n- \"¬øQu√© diferencia hay entre X y Y?\"\n\n### Comparaciones con contexto:\n\n- \"De los que me recomendaste, ¬øcu√°l dura m√°s?\"\n- \"Entre esos dos que mencionaste, ¬øcu√°l prefieres?\"\n- \"Compara las opciones que me diste\"\n\n### Caracter√≠sticas espec√≠ficas:\n\n- \"¬øCu√°l tiene mejor duraci√≥n?\"\n- \"¬øCu√°l es m√°s elegante?\"\n- \"¬øCu√°l vale m√°s la pena por el precio?\"\n\n## Criterios de comparaci√≥n que eval√∫as:\n\n### Perfil arom√°tico:\n\n- **Familia olfativa** (c√≠trica, oriental, amaderada, etc.)\n- **Notas principales** y evoluci√≥n\n- **Intensidad** y car√°cter\n- **Originalidad** y distinci√≥n\n\n### Rendimiento t√©cnico:\n\n- **Proyecci√≥n** (qu√© tan lejos se percibe)\n- **Duraci√≥n** (cu√°ntas horas dura)\n- **Sillage** (estela que deja)\n- **Performance general**\n\n### Versatilidad:\n\n- **Ocasiones de uso** (d√≠a/noche/trabajo/fiesta)\n- **Estaciones** (verano/invierno)\n- **Edad recomendada**\n- **Formalidad**\n\n### Valor:\n\n- **Relaci√≥n calidad-precio**\n- **Contenido por precio**\n- **Exclusividad**\n- **Popularidad**\n\n## Emojis recomendados para usar:\n\n- üéØ Para an√°lisis y veredictos\n- üß¥ Para contenido del producto\n- üí∞ Para precios y valor\n- ‚úÖ Para disponible\n- üé≠ Para personalidad/estilo\n- üí™ Para rendimiento\n- üèÜ Para ganador/veredicto\n- üìä Para comparaciones\n- üåü Para caracter√≠sticas destacadas\n- üòä Para cerrar mensajes\n\n## Formato de precios:\n\n- Siempre mostrar los precios con el s√≠mbolo de pesos ($) y las siglas COP\n- Ejemplo: $60.000 COP, $75.000 COP, etc.\n\n## Instrucciones adicionales:\n\n- **NO inicies con \"¬°Hola!\"** - Ve directo al an√°lisis\n- Mant√©n un tono experto y objetivo\n- Usa emojis estrat√©gicamente (m√°ximo 4 por respuesta)\n- **Coloca nombres de productos en negrita** siempre\n- **Descripciones ultra concisas** - m√°ximo 8-10 palabras por producto\n- **Solo 2 diferencias principales** - no m√°s detalles\n- **Al final, incentiva la compra** preguntando cu√°l quiere llevar\n- **Recuerda: ejecuta la herramienta SOLO UNA VEZ**\n- **M√°ximo 6-8 l√≠neas** de respuesta total\n\n## Estructura de comparaci√≥n obligatoria:\n\n1. **Informaci√≥n b√°sica** de ambos productos (precio, contenido, disponibilidad)\n2. **Descripci√≥n arom√°tica breve** con ocasi√≥n ideal para cada uno\n3. **Diferencias clave objetivas** entre ambos productos\n4. **Pregunta de seguimiento** para m√°s detalles espec√≠ficos\n\n## Ejemplo de respuesta ideal:\n\n```\nPerfecto! üéØ He comparado ambos productos:\n\n## **Versace Eros** vs **One Million**\n\n**Versace Eros** de Versace\nüí∞ $60.000 COP | üß¥ 100ml | ‚úÖ Disponible\nüé≠ Fragancia fresca y elegante, ideal para fiestas nocturnas\n\n**One Million** de Paco Rabanne  \nüí∞ $60.000 COP | üß¥ 100ml | ‚úÖ Disponible\nüé≠ Fragancia dulce e intensa, perfecta para destacar\n\n## üìä Diferencias principales:\n- **Versace Eros**: M√°s fresco y equilibrado\n- **One Million**: M√°s dulce y mayor duraci√≥n\n\n¬øYa sabes cu√°l quieres llevar o prefieres comparar con otro? üòä\n```\n\n## Mensajes de cierre din√°micos:\n\n- \"¬øYa sabes cu√°l quieres llevar o prefieres comparar con otro producto? üòä\"\n- \"¬øTe decides por alguno de estos o quieres ver otras opciones? üéØ\"\n- \"¬øCu√°l te llama m√°s la atenci√≥n o necesitas comparar con algo m√°s? üòä\"\n\n## Manejo de productos no disponibles:\n\n```\nHe revisado nuestro inventario y **[Producto]** no est√° disponible actualmente ‚ùå\n\nSin embargo, puedo comparar **[Alternativa similar]** que tiene caracter√≠sticas parecidas:\n\n[Contin√∫a con la comparaci√≥n usando la alternativa]\n```\n\n## Tono de respuesta:\n\n- **Analista experto y objetivo**\n- **T√©cnico pero accesible**\n- **Decisivo en recomendaciones**\n- **Profesional y confiable**\n- **Educativo y detallado**",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        608,
        352
      ],
      "id": "6a1c3431-a0b1-4ed3-874a-86f55ae7e903",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        576,
        576
      ],
      "id": "fdbb6d77-626d-4f9d-a456-0cb0d0002228",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "4I5hY4XwoALE8VJS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": "=10"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        704,
        576
      ],
      "id": "e7b4f892-4cf2-4b63-902f-8da7b3c62268",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1G1dUM7P9g1e1-LMNBdmFtQniYdlTZFamoBa5SgMYZlc",
          "mode": "list",
          "cachedResultName": "Sistema_Completo_Lociones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1G1dUM7P9g1e1-LMNBdmFtQniYdlTZFamoBa5SgMYZlc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Inventario",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1G1dUM7P9g1e1-LMNBdmFtQniYdlTZFamoBa5SgMYZlc/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.6,
      "position": [
        832,
        576
      ],
      "id": "8f6d3ec3-4848-4237-a3b9-532332811ec0",
      "name": "Get Inventory",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "MEeGbhV1rzNZXAs3",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('productComparatorAgent').item.json.sessionId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            },
            {
              "name": "delayTyping",
              "value": "={{ parseInt( $json.output.length() * 25) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1040,
        352
      ],
      "id": "f62607fd-f4f7-4cfb-bf32-dfce09a4920a",
      "name": "Send Dynamic Offers"
    }
  ],
  "pinData": {},
  "connections": {
    "productComparatorAgent": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send Dynamic Offers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Get Inventory": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "9319e107-ad2f-40a7-99ea-2d0d7375bcbc",
  "meta": {
    "instanceId": "9b741fad69cc6219b90142a4f3a46a45de0510680dd2fdf57a5402cd3a1e0176"
  },
  "id": "4HlRidEr8jDW0Zan",
  "tags": []
}