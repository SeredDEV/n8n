{
  "name": "z-Api",
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message_type }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f1f4f21d-7bac-4148-8fa5-eb91e67e3f5e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message_type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "53ea1f96-c52a-4d1f-a00d-c0cafb1feb82"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message_type }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b2b2b2b2-2222-3333-4444-555555555555"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message_type }}",
                    "rightValue": "button_response",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c3c3c3c3-3333-4444-5555-666666666666"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "button"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -3024,
        384
      ],
      "id": "21e27863-ba53-4dd7-a22d-fab641d638e9",
      "name": "Message Type Router"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "credentials-object",
              "name": "credentials",
              "value": "={{ { \"z_api_token\": $json.headers['z-api-token'], \"instance_id\": $json.body.instanceId } }}",
              "type": "object"
            },
            {
              "id": "system-object",
              "name": "system",
              "value": "={{ { \"execution_mode\": $json.executionMode, \"webhook_url\": $json.webhookUrl, \"user_agent\": $json.headers['user-agent'], \"origin_server\": $json.headers.origin, \"client_ip\": $json.headers['x-real-ip'] } }}",
              "type": "object"
            },
            {
              "id": "user-object",
              "name": "user",
              "value": "={{ { \"sender_phone\": $json.body.phone, \"connected_phone\": $json.body.connectedPhone, \"chat_name\": $json.body.chatName, \"sender_name\": $json.body.senderName, \"chat_lid\": $json.body.chatLid } }}",
              "type": "object"
            },
            {
              "id": "message-type-detector",
              "name": "message_type",
              "value": "={{ $json.body.text ? 'text' : $json.body.audio ? 'audio' : $json.body.image ? 'image' : $json.body.buttonsResponseMessage ? 'button_response' : $json.body.document ? ($json.body.document.mimeType && $json.body.document.mimeType.startsWith('audio/') ? 'audio_file' : $json.body.document.mimeType && $json.body.document.mimeType.startsWith('video/') ? 'video' : 'document') : 'unknown' }}",
              "type": "string"
            },
            {
              "id": "message-object",
              "name": "message",
              "value": "={{ { \"message_id\": $json.body.messageId, \"timestamp\": $json.body.momment, \"formatted_date\": DateTime.fromMillis($json.body.momment).toFormat('yyyy-MM-dd HH:mm:ss'), \"formatted_date_utc_minus_5\": DateTime.fromMillis($json.body.momment).setZone('UTC-5').toFormat('yyyy-MM-dd HH:mm:ss'), \"message_status\": $json.body.status, \"message_type\": ($json.body.text ? 'text' : $json.body.audio ? 'audio' : $json.body.image ? 'image' : $json.body.buttonsResponseMessage ? 'button_response' : $json.body.document ? ($json.body.document.mimeType && $json.body.document.mimeType.startsWith('audio/') ? 'audio_file' : $json.body.document.mimeType && $json.body.document.mimeType.startsWith('video/') ? 'video' : 'document') : 'unknown') } }}",
              "type": "object"
            },
            {
              "id": "content-text",
              "name": "text_content",
              "value": "={{ $json.body.text ? { \"message\": $json.body.text.message } : null }}",
              "type": "object"
            },
            {
              "id": "content-audio",
              "name": "audio_content",
              "value": "={{ $json.body.audio ? { \"audio_url\": $json.body.audio.audioUrl, \"duration_seconds\": $json.body.audio.seconds, \"mime_type\": $json.body.audio.mimeType, \"is_ptt\": $json.body.audio.ptt, \"view_once\": $json.body.audio.viewOnce, \"source\": 'audio_object' } : null }}",
              "type": "object"
            },
            {
              "id": "content-audio-file",
              "name": "audio_file_content",
              "value": "={{ ($json.body.document && $json.body.document.mimeType && $json.body.document.mimeType.startsWith('audio/')) ? { \"audio_url\": $json.body.document.documentUrl, \"file_name\": $json.body.document.fileName, \"mime_type\": $json.body.document.mimeType, \"caption\": $json.body.document.caption, \"title\": $json.body.document.title, \"source\": 'document_object' } : null }}",
              "type": "object"
            },
            {
              "id": "content-image",
              "name": "image_content",
              "value": "={{ $json.body.image ? { \"image_url\": $json.body.image.imageUrl, \"thumbnail_url\": $json.body.image.thumbnailUrl, \"caption\": $json.body.image.caption, \"mime_type\": $json.body.image.mimeType, \"view_once\": $json.body.image.viewOnce, \"width\": $json.body.image.width, \"height\": $json.body.image.height } : null }}",
              "type": "object"
            },
            {
              "id": "content-video",
              "name": "video_content",
              "value": "={{ ($json.body.document && $json.body.document.mimeType && $json.body.document.mimeType.startsWith('video/')) ? { \"video_url\": $json.body.document.documentUrl, \"file_name\": $json.body.document.fileName, \"mime_type\": $json.body.document.mimeType, \"caption\": $json.body.document.caption, \"title\": $json.body.document.title, \"source\": 'document_object' } : null }}",
              "type": "object"
            },
            {
              "id": "content-document",
              "name": "document_content",
              "value": "={{ ($json.body.document && (!$json.body.document.mimeType || (!$json.body.document.mimeType.startsWith('audio/') && !$json.body.document.mimeType.startsWith('video/')))) ? { \"document_url\": $json.body.document.documentUrl, \"file_name\": $json.body.document.fileName, \"title\": $json.body.document.title, \"caption\": $json.body.document.caption, \"mime_type\": $json.body.document.mimeType, \"page_count\": $json.body.document.pageCount } : null }}",
              "type": "object"
            },
            {
              "id": "content-button",
              "name": "button_content",
              "value": "={{ $json.body.buttonsResponseMessage ? { \"button_id\": $json.body.buttonsResponseMessage.buttonId, \"button_text\": $json.body.buttonsResponseMessage.message, \"button_response\": $json.body.buttonsResponseMessage.buttonId, \"display_text\": $json.body.buttonsResponseMessage.message } : null }}",
              "type": "object"
            },
            {
              "id": "flags-object",
              "name": "flags",
              "value": "={{ { \"from_me\": $json.body.fromMe, \"is_group\": $json.body.isGroup, \"is_newsletter\": $json.body.isNewsletter, \"is_forwarded\": $json.body.forwarded, \"is_broadcast\": $json.body.broadcast, \"callback_type\": $json.body.type, \"from_api\": $json.body.fromApi, \"is_status_reply\": $json.body.isStatusReply, \"is_edit\": $json.body.isEdit, \"waiting_message\": $json.body.waitingMessage, \"message_expiration_seconds\": $json.body.messageExpirationSeconds || 0 } }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3248,
        416
      ],
      "id": "629c91df-ca42-451f-81f0-e68a7117af0d",
      "name": "WhatsApp Message Parser"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "50a91089-2c34-4dd0-8896-2715bd6e9612",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3472,
        416
      ],
      "id": "852dc0cf-eee3-4b06-96d2-7434d5f2105c",
      "name": "Webhook",
      "webhookId": "50a91089-2c34-4dd0-8896-2715bd6e9612"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -2800,
        352
      ],
      "id": "dd409521-a6e3-458e-8735-fcd45edabb22",
      "name": "Pausa",
      "webhookId": "0bfa0972-a628-48bb-be5d-b3c30b33df0e"
    },
    {
      "parameters": {
        "url": "={{ $json.audio_content.audio_url }}",
        "options": {
          "response": {
            "response": {
              "neverError": true,
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2800,
        160
      ],
      "id": "8333ce84-4d86-45b2-82ad-918529eedb94",
      "name": "Download Audio File"
    },
    {
      "parameters": {
        "url": "={{ $json.image_content.image_url }}",
        "options": {
          "response": {
            "response": {
              "neverError": true,
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2800,
        544
      ],
      "id": "cf653602-6501-49dc-8e34-58663392a016",
      "name": "Download Image File"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "# Instrucciones para DescripciÃ³n de Imagen\nDescribe esta imagen en espaÃ±ol.",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -2576,
        544
      ],
      "id": "4f8f60c9-6636-4187-9180-3ae5bae89d18",
      "name": "Analyze Image",
      "credentials": {
        "openAiApi": {
          "id": "4I5hY4XwoALE8VJS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "button-response-id",
              "name": "button_id",
              "value": "={{ $json.button_content.button_id }}",
              "type": "string"
            },
            {
              "id": "button-response-text",
              "name": "button_text",
              "value": "={{ $json.button_content.button_text || $json.button_content.display_text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2800,
        1232
      ],
      "id": "16d840a8-6820-4683-9b2c-a5935ab53845",
      "name": "Process Button Response"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.button_id }}",
                    "rightValue": "catalogo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "catalog-button-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "catalogo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.button_id }}",
                    "rightValue": "ofertas",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "offers-button-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ofertas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.button_id }}",
                    "rightValue": "comprar",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "buy-button-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "comprar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.button_id }}",
                    "rightValue": "pedido",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "order-button-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pedido"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2576,
        1200
      ],
      "id": "71dcbf2e-618c-4a6c-824d-e96d9bfb0de3",
      "name": "Button Response Router"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "es",
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -2576,
        160
      ],
      "id": "3c1f4fe7-fb56-420d-906b-f5543cd49364",
      "name": "Transcribe a recording",
      "credentials": {
        "openAiApi": {
          "id": "4I5hY4XwoALE8VJS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "23b785c3-f38e-4706-80b7-51f333bba3bd",
              "name": "mensaje",
              "type": "string",
              "value": "={{ $json.text || $json.content || $json.button_text || $json.button_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "69805333-82b0-4af7-b76a-550e1e5214d2",
      "name": "Extract Message Content",
      "type": "n8n-nodes-base.set",
      "position": [
        -2352,
        352
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d4b9efeb-9a68-43e3-bc4c-cd207510bddf",
              "name": "text",
              "value": "={{ $json.text_content.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2576,
        352
      ],
      "id": "058d9a01-82a5-40fe-beac-d2466ef750e9",
      "name": "Obtener Texto"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}",
        "messageData": "={{ $json.mensaje }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2128,
        352
      ],
      "id": "3576f13b-3c67-4594-826a-9f42febf8543",
      "name": "Store Message in Buffer",
      "credentials": {
        "redis": {
          "id": "HBZtjEwzw7Xu4Gm2",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1904,
        352
      ],
      "id": "eab92e45-1f03-462f-b583-724fcd6acff6",
      "name": "Wait for Buffer",
      "webhookId": "05929f0b-cb6a-48f9-901e-bbefe359f336"
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1680,
        352
      ],
      "id": "8bfdc3e1-53fa-424c-9efc-012fc7b2f6a7",
      "name": "Retrieve Messages from Buffer",
      "credentials": {
        "redis": {
          "id": "HBZtjEwzw7Xu4Gm2",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "87d5a006-5e35-4dbf-a3dc-e5420b918845",
              "leftValue": "={{ $json.propertyName.last() }}",
              "rightValue": "={{ $('Extract Message Content').item.json.mensaje }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1456,
        352
      ],
      "id": "36f42d41-3bfc-4f31-b193-f5c73dc5e280",
      "name": "Check for Duplicate Message"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1232,
        176
      ],
      "id": "5351af1d-38df-42d5-b226-b3d971c6e45e",
      "name": "Clear Buffer Cache",
      "credentials": {
        "redis": {
          "id": "HBZtjEwzw7Xu4Gm2",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1232,
        368
      ],
      "id": "a8fd631b-2db6-481d-bc77-9465e0ff749d",
      "name": "Skip Duplicate Message"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f6459d32-0468-4e3c-8572-7b36e1fc2172",
              "name": "conversation_content",
              "value": "={{ $json.propertyName.join('\\n') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1008,
        176
      ],
      "id": "3985d04b-ff21-43fb-acc3-1c73256b49ff",
      "name": "Format Final Output"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    '{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}' as session_id,\n    EXISTS (\n        SELECT 1 \n        FROM n8n_pro_conversation_states \n        WHERE session_id = '{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}'\n    ) as existe",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -784,
        176
      ],
      "id": "67723d13-15ed-4332-93a5-ba6abbc17bf3",
      "name": "Get session_id",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7500bd18-477a-4fbe-b21d-ea6bbcc0a5d5",
              "leftValue": "={{ $json.existe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -560,
        176
      ],
      "id": "3b6e6010-6bcf-4038-9493-cddaa630b656",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// Obtener hora UTC y ajustarla a UTC-5\nconst ahora = new Date();\nconst horaUTC = ahora.getUTCHours();\nconst horaUTC5 = (horaUTC + 24 - 5) % 24;\n\n// Determinar perÃ­odo del dÃ­a\nlet periodo = '';\n\nif (horaUTC5 >= 5 && horaUTC5 < 12) {\n  periodo = 'maÃ±ana';\n} else if (horaUTC5 >= 12 && horaUTC5 < 18) {\n  periodo = 'tarde';\n} else {\n  periodo = 'noche';\n}\n\n// Retornar perÃ­odo junto con datos necesarios\nreturn [\n  {\n    json: {\n      periodo: periodo,\n      hora: horaUTC5,\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        768
      ],
      "id": "00e47220-1f45-4ac3-8a47-81a5d64d7a9a",
      "name": "Dynamic Time Greeting"
    },
    {
      "parameters": {
        "jsCode": "const saludos = [\n`ðŸŒ¸ Â¡Hola! Gracias por escribir a *Ed PerfumerÃ­a*  \nEstamos encantados de ayudarte a encontrar la fragancia ideal.`,\n\n`ðŸ’¬ Â¡Bienvenido a *Ed PerfumerÃ­a*!  \nGracias por elegirnos para tu prÃ³xima compra de perfumes.`,\n\n`ðŸŽ‰ Â¡Hola! QuÃ© gusto tenerte en *Ed PerfumerÃ­a*  \nEstamos aquÃ­ para ayudarte a encontrar tu aroma perfecto.`,\n\n`ðŸŒŸ Â¡Gracias por comunicarte con *Ed PerfumerÃ­a*!  \nNos alegra poder atenderte ðŸ˜Š`,\n\n`ðŸš€ Â¡Hola y bienvenido a *Ed PerfumerÃ­a*!  \nEs un placer atenderte hoy âœ¨`,\n\n`ðŸ™Œ Â¡Hola! Gracias por escribir a *Ed PerfumerÃ­a*  \nEstamos encantados de atenderte. ðŸ’`,\n\n`ðŸ‘‹ Â¡Bienvenid@ a *Ed PerfumerÃ­a*!  \nNos alegra recibir tu mensaje. ðŸ’–`,\n\n`âœ¨ Â¡Hola! Gracias por contactar a *Ed PerfumerÃ­a*  \nNos alegra mucho tenerte por aquÃ­ ðŸ˜Š`,\n\n`ðŸŒŸ Â¡Gracias por comunicarte con *Ed PerfumerÃ­a*!  \nEstamos aquÃ­ para ayudarte a encontrar tu fragancia ideal. ðŸ§´âœ¨`,\n\n`ðŸŽ‰ Â¡Bienvenido a *Ed PerfumerÃ­a*!  \nGracias por escribirnos. Estamos listos para asesorarte.`\n];\n\n// Selecciona uno al azar\nconst saludoAleatorio = saludos[Math.floor(Math.random() * saludos.length)];\nreturn [\n  {\n    json: {\n      output: saludoAleatorio\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -336,
        -128
      ],
      "id": "7033e5d9-92c7-4bdd-b9a3-1d0d2ee83e2d",
      "name": "Dynamic Greeting"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.periodo }}",
                    "rightValue": "maÃ±ana",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "eb8f4c83-efd2-4595-b674-25dc1c0ad1b8"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "maÃ±ana"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dcc3cd98-a426-4020-8af1-a851981f2055",
                    "leftValue": "={{ $json.periodo }}",
                    "rightValue": "tarde",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tarde"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b515e6bc-c3a2-4471-b9ee-ff723e6ff6cc",
                    "leftValue": "={{ $json.periodo }}",
                    "rightValue": "noche",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "noche"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2128,
        752
      ],
      "id": "7141152b-9336-43f9-a034-f18849e987b0",
      "name": "Switch1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            },
            {
              "name": "delayTyping",
              "value": "={{ parseInt( $json.output.length() * 25) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -112,
        -128
      ],
      "id": "bca08f9f-5200-4812-bd94-f001547f49fe",
      "name": "Send Dynamic Greeting"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-button-list",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"phone\": \"{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}\",\n  \"message\": \"{{ (() => { const h = new Date(new Date().getTime() - 18000000).getHours(); return h >= 5 && h < 12 ? 'Â¡Buenos dÃ­as!' : h >= 12 && h < 18 ? 'Â¡Buenas tardes!' : 'Â¡Buenas noches!'; })() }} ðŸŒ¸\\n\\nÂ¿QuÃ© te gustarÃ­a hacer?\",\n  \"delayTyping\": 1500,\n  \"buttonList\": {\n    \"buttons\": [\n      {\n        \"id\": \"comprar\",\n        \"label\": \"ðŸ›’ Comprar\"\n      },\n      {\n        \"id\": \"catalogo\",\n        \"label\": \"ðŸ“‹ CatÃ¡logo\"\n      },\n      {\n        \"id\": \"ofertas\",\n        \"label\": \"ðŸ”¥ Ofertas\"\n      },\n      {\n        \"id\": \"pedido\",\n        \"label\": \"ðŸ“¦ Consultar Pedido\"\n      }\n    ]\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        496,
        -128
      ],
      "id": "d66ffd6d-acea-49bb-8070-1a2d91d6aee2",
      "name": "Send Buttons"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1680,
        816
      ],
      "id": "a07e3554-61bf-4247-b345-485c71a000e8",
      "name": "Merge Audio"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-audio",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
            },
            {
              "name": "audio",
              "value": "=data:{{ $('Merge Audio').item.binary.data.mimeType }};base64,{{ $('Merge Audio').item.binary.data.data }}"
            },
            {
              "name": "delayTyping",
              "value": "6"
            },
            {
              "name": "waveform",
              "value": "true"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1456,
        832
      ],
      "id": "f6350737-0a0d-40bf-ac78-919fd8a0fe40",
      "name": "Send Audio"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-document/pdf",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').first().json.user.sender_phone }}"
            },
            {
              "name": "document",
              "value": "https://drive.google.com/uc?export=download&id=1z1N-NqCHW2PrC1_HJS01MP6geTL6Jf_S"
            },
            {
              "name": "fileName",
              "value": "CatÃ¡logo Ed PerfumerÃ­a Hombre"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1232,
        832
      ],
      "id": "1ce81b28-40cf-40ec-9392-c8e31235b7fa",
      "name": "Send Catalog Man"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-document/pdf",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').first().json.user.sender_phone }}"
            },
            {
              "name": "document",
              "value": "https://drive.google.com/uc?export=download&id=1sf7vcqR6USGi-b496e7kCshxMNwI-4c4"
            },
            {
              "name": "fileName",
              "value": "CatÃ¡logo Ed PerfumerÃ­a Mujer"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1008,
        832
      ],
      "id": "bad2d0f8-eb89-4d76-89db-811c8d943dc4",
      "name": "Send Catalog Women"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1UND_G3K4tu_xmjsTOSyq3ypRVpzg95HH",
          "mode": "list",
          "cachedResultName": "Buenos Dias.ogg",
          "cachedResultUrl": "https://drive.google.com/file/d/1UND_G3K4tu_xmjsTOSyq3ypRVpzg95HH/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1904,
        560
      ],
      "id": "6aa2a2a5-3c53-4845-ab53-2f014e20f872",
      "name": "Download Good Morning",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1oFABnmJkXuevND9TxwJP_zcM2VLsDPtb",
          "mode": "list",
          "cachedResultName": "Buenas Tardes.ogg",
          "cachedResultUrl": "https://drive.google.com/file/d/1oFABnmJkXuevND9TxwJP_zcM2VLsDPtb/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1904,
        752
      ],
      "id": "4ce4c093-a1e9-4bb5-896f-4b6e8360a612",
      "name": "Download Good Afternoon",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "16PkBRIK-Iv-VKInmhW1nq5Qfjc0EKWn2",
          "mode": "list",
          "cachedResultName": "Buenas Noches.ogg",
          "cachedResultUrl": "https://drive.google.com/file/d/16PkBRIK-Iv-VKInmhW1nq5Qfjc0EKWn2/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1904,
        944
      ],
      "id": "f6c5071b-9cfa-4dbb-9118-b61101f82ca4",
      "name": "Download  Good Night",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const ofertas = [\n`ðŸŽ€ *Promociones especiales de Ed PerfumerÃ­a*\n\nðŸ’Ž **Ofertas disponibles:**\n1 unidad â†’ $60.000\n2 unidades â†’ $100.000  \n3 unidades â†’ $120.000\n6 unidades â†’ $210.000\n\nðŸ”¥ Â¡Fragancias increÃ­bles a precios Ãºnicos!`,\n\n`ðŸŽ *Ofertas Ed PerfumerÃ­a*\n\nâœ¨ **Precios especiales:**\n1 por $60.000\n2 por $100.000\n3 por $120.000\n6 por $210.000\n\nðŸ’« Â¡Aprovecha nuestros mejores precios!`,\n\n`ðŸ’Ž *PromociÃ³n de la semana*\n\nðŸ”¥ **Ofertas vigentes:**\n1 unidad: $60.000\n2 unidades: $100.000\n3 unidades: $120.000\n6 unidades: $210.000\n\nðŸŽ‰ Â¡No dejes pasar estas ofertas!`,\n\n`ðŸŒŸ *Ofertas especiales*\n\nðŸ’¥ **Promociones disponibles:**\n1 x $60.000 | 2 x $100.000 | 3 x $120.000 | 6 x $210.000\n\nâœ¨ Â¡Solo por tiempo limitado!`,\n\n`ðŸŽŠ *Ed PerfumerÃ­a - Ofertas*\n\nðŸŽ **Precios increÃ­bles:**\n1 fragancia â†’ $60.000\n2 fragancias â†’ $100.000\n3 fragancias â†’ $120.000\n6 fragancias â†’ $210.000\n\nðŸ”¥ Â¡Te van a encantar!`,\n\n`ðŸ’– *Promociones actuales*\n\nðŸŒ¸ **Ofertas de hoy:**\n1 unidad por $60.000\n2 unidades por $100.000\n3 unidades por $120.000\n6 unidades por $210.000\n\nðŸ’Ž Â¡Aprovecha esta oportunidad!`,\n\n`ðŸš€ *Ofertas Ed PerfumerÃ­a*\n\nâ­ **Precios especiales:**\n1 â†’ $60.000\n2 â†’ $100.000\n3 â†’ $120.000\n6 â†’ $210.000\n\nðŸŽ‰ Â¡Promociones por tiempo limitado!`,\n\n`ðŸŒˆ *PromociÃ³n especial*\n\nðŸ’« **Ofertas vigentes:**\n1 unidad: $60.000\n2 unidades: $100.000\n3 unidades: $120.000\n6 unidades: $210.000\n\nðŸ”¥ Â¡No te las pierdas!`,\n\n`ðŸŽ€ *Ofertas de la semana*\n\nâœ¨ **Precios Ãºnicos:**\n1 x $60.000 â€¢ 2 x $100.000 â€¢ 3 x $120.000 â€¢ 6 x $210.000\n\nðŸŽ Â¡Fragancias increÃ­bles a precios especiales!`,\n\n`ðŸ’ *Ed PerfumerÃ­a - Promociones*\n\nðŸŒŸ **Ofertas disponibles:**\n1 unidad = $60.000\n2 unidades = $100.000\n3 unidades = $120.000\n6 unidades = $210.000\n\nðŸ’Ž Â¡Aprovecha nuestras mejores ofertas!`\n];\n\n// Selecciona uno al azar\nconst ofertaAleatoria = ofertas[Math.floor(Math.random() * ofertas.length)];\nreturn [\n  {\n    json: {\n      output: ofertaAleatoria\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        1136
      ],
      "id": "711aeec0-e45c-4b1f-9c1a-e451f34dae88",
      "name": "Dynamic Offers"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            },
            {
              "name": "delayTyping",
              "value": "={{ parseInt( $json.output.length() * 25) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2128,
        1136
      ],
      "id": "a7fbc787-90bb-4205-a8cb-c06bc288c642",
      "name": "Send Dynamic Offers"
    },
    {
      "parameters": {
        "jsCode": "const comprar = [\n`ðŸ›’ *Â¡Perfecto! Veamos quÃ© te interesa*\n\nÂ¿En quÃ© fragancia estÃ¡s pensando?\n- Â¿Tienes alguna en mente?\n- Â¿Buscas algo especÃ­fico?\n\nðŸ’Ž Â¡CuÃ©ntanos para ayudarte mejor!`,\n\n`ðŸ›ï¸ *Â¡Excelente!*\n\nÂ¿QuÃ© tipo de fragancia te llama la atenciÃ³n?\n- Â¿Algo dulce o fresco?\n- Â¿Para hombre o mujer?\n\nâœ¨ Â¡Dinos quÃ© buscas!`,\n\n`ðŸŽ *Â¡Genial! Hablemos de fragancias*\n\nÂ¿QuÃ© producto te interesa?\n- Â¿Tienes marca favorita?\n- Â¿Buscas algo nuevo?\n\nðŸš€ Â¡CompÃ¡rtenos tu preferencia!`,\n\n`ðŸ’³ *Â¡Listo para ayudarte!*\n\nÂ¿En quÃ© fragancia estÃ¡s interesado/a?\n- Â¿Algo en particular?\n- Â¿Necesitas recomendaciones?\n\nðŸŒŸ Â¡CuÃ©ntanos quÃ© buscas!`,\n\n`ðŸ›’ *Â¡Vamos a encontrar tu fragancia ideal!*\n\nÂ¿QuÃ© tipo de aroma prefieres?\n- Â¿Dulce, fresco, amaderado?\n- Â¿Para ocasiÃ³n especial?\n\nðŸ’Ž Â¡Dinos quÃ© te gusta!`,\n\n`ðŸŽ‰ *Â¡Perfecto! Descubramos tu fragancia*\n\nÂ¿QuÃ© producto tienes en mente?\n- Â¿Alguna marca especÃ­fica?\n- Â¿Buscas algo trending?\n\nâœ¨ Â¡Comparte tu interÃ©s!`,\n\n`ðŸ›ï¸ *Â¡Excelente elecciÃ³n!*\n\nÂ¿En quÃ© fragancia estÃ¡s pensando?\n- Â¿Algo clÃ¡sico o moderno?\n- Â¿Tienes preferencias?\n\nðŸ”¥ Â¡CuÃ©ntanos quÃ© buscas!`,\n\n`ðŸ’ *Â¡Hablemos de tu fragancia perfecta!*\n\nÂ¿QuÃ© tipo de aroma te interesa?\n- Â¿Para uso diario o especial?\n- Â¿Tienes alguna en mente?\n\nðŸŒˆ Â¡Dinos quÃ© prefieres!`,\n\n`ðŸŽŠ *Â¡Genial! Encontremos tu aroma*\n\nÂ¿QuÃ© fragancia te llama la atenciÃ³n?\n- Â¿Buscas algo especÃ­fico?\n- Â¿Necesitas sugerencias?\n\nðŸ’« Â¡Comparte tu gusto!`,\n\n`ðŸš€ *Â¡Perfecto! Hablemos de fragancias*\n\nÂ¿En quÃ© producto estÃ¡s interesado/a?\n- Â¿Tienes marca favorita?\n- Â¿Algo dulce o fresco?\n\nðŸŽ Â¡CuÃ©ntanos tu preferencia!`\n];\n\n// Selecciona uno al azar\nconst comprarAleatorio = comprar[Math.floor(Math.random() * comprar.length)];\nreturn [\n  {\n    json: {\n      output: comprarAleatorio\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        1328
      ],
      "id": "f494babf-7a04-4539-856e-0516a8e64b1c",
      "name": "Dynamic Buy"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            },
            {
              "name": "delayTyping",
              "value": "={{ parseInt( $json.output.length() * 25) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2128,
        1328
      ],
      "id": "23526dbc-8458-41a3-bf8b-489d60bdb1d5",
      "name": "Send Dynamic Buy"
    },
    {
      "parameters": {
        "jsCode": "const consultarPedido = [\n`ðŸ“¦ *Â¡Perfecto! Consultemos tu pedido*\n\nÂ¿QuÃ© necesitas saber sobre tu compra?\n- Â¿Estado del envÃ­o?\n- Â¿NÃºmero de guÃ­a?\n- Â¿Tiempo de entrega?\n\nðŸšš Â¡Estamos aquÃ­ para ayudarte!`,\n\n`ðŸ” *Â¡Excelente! Revisemos tu orden*\n\nÂ¿Sobre quÃ© quieres consultar?\n- Â¿DÃ³nde estÃ¡ mi pedido?\n- Â¿CuÃ¡ndo llega?\n- Â¿Datos de envÃ­o?\n\nðŸ“‹ Â¡Dinos quÃ© necesitas saber!`,\n\n`ðŸ“± *Â¡Genial! Veamos tu pedido*\n\nÂ¿QuÃ© informaciÃ³n necesitas?\n- Â¿Estado actual del envÃ­o?\n- Â¿NÃºmero de seguimiento?\n- Â¿Fecha estimada de entrega?\n\nâœ¨ Â¡Consultemos juntos!`,\n\n`ðŸš› *Â¡Listo para ayudarte!*\n\nÂ¿QuÃ© quieres saber de tu compra?\n- Â¿EstÃ¡ en camino?\n- Â¿Tienes la guÃ­a?\n- Â¿AlgÃºn problema?\n\nðŸŒŸ Â¡Revisemos tu pedido!`,\n\n`ðŸ“¦ *Â¡Vamos a consultar tu envÃ­o!*\n\nÂ¿Sobre quÃ© necesitas informaciÃ³n?\n- Â¿Estado del pedido?\n- Â¿Seguimiento de envÃ­o?\n- Â¿Tiempo de llegada?\n\nðŸ’Ž Â¡Estamos para resolver tus dudas!`,\n\n`ðŸ”Ž *Â¡Perfecto! Consultemos tu orden*\n\nÂ¿QuÃ© informaciÃ³n buscas?\n- Â¿DÃ³nde estÃ¡ mi compra?\n- Â¿NÃºmero de guÃ­a?\n- Â¿CuÃ¡ndo llega?\n\nðŸŽ‰ Â¡Revisemos juntos!`,\n\n`ðŸ“‹ *Â¡Excelente! Veamos tu pedido*\n\nÂ¿QuÃ© necesitas consultar?\n- Â¿Estado de envÃ­o?\n- Â¿Datos de seguimiento?\n- Â¿InformaciÃ³n de entrega?\n\nðŸ”¥ Â¡Dinos quÃ© quieres saber!`,\n\n`ðŸšš *Â¡Consultemos tu compra!*\n\nÂ¿Sobre quÃ© tienes dudas?\n- Â¿Mi pedido ya saliÃ³?\n- Â¿CuÃ¡l es mi guÃ­a?\n- Â¿CuÃ¡ndo llega?\n\nðŸŒˆ Â¡Estamos para ayudarte!`,\n\n`ðŸ“± *Â¡Genial! Revisemos tu envÃ­o*\n\nÂ¿QuÃ© informaciÃ³n necesitas?\n- Â¿Estado actual?\n- Â¿NÃºmero de seguimiento?\n- Â¿Fecha de entrega?\n\nðŸ’« Â¡Consultemos tu pedido!`,\n\n`ðŸ” *Â¡Perfecto! Veamos tu orden*\n\nÂ¿QuÃ© quieres saber?\n- Â¿DÃ³nde estÃ¡ mi pedido?\n- Â¿GuÃ­a de envÃ­o?\n- Â¿Tiempo estimado?\n\nðŸŽ Â¡Resolvamos tus dudas!`\n];\n\n// Selecciona uno al azar\nconst consultarPedidoAleatorio = consultarPedido[Math.floor(Math.random() * consultarPedido.length)];\nreturn [\n  {\n    json: {\n      output: consultarPedidoAleatorio\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2352,
        1520
      ],
      "id": "4b89f8c1-4443-43b6-bd3e-a1171d93151c",
      "name": "Dynamic Order"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3E437048CF3D40E574FE2EE02AE98ECC/token/25512E9D7889005341E093C0/send-text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "client-token",
              "value": "F71f72d577fd94b2995487e18acdaa9ceS"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            },
            {
              "name": "delayTyping",
              "value": "={{ parseInt( $json.output.length() * 25) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2128,
        1520
      ],
      "id": "96817423-3141-4258-94a6-028541ae10a2",
      "name": "Send Dynamic Order"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT estado_saludo_pro('{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1088,
        -128
      ],
      "id": "465fb9d3-87f0-42ce-a5a0-6fe61e580f7d",
      "name": "Execute Status Greeting",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT estado_catalogo_pro('{{ $('WhatsApp Message Parser').first().json.user.sender_phone }}');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -784,
        832
      ],
      "id": "2a6d22fb-b01c-486a-b721-c4fec78c02f8",
      "name": "Execute Status Catalog",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT estado_ofertas_pro('{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1904,
        1136
      ],
      "id": "579ff869-7ef7-47c7-a6dd-2e0847b3a1bf",
      "name": "Execute Status Offers",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT estado_ventas_pro('{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1904,
        1328
      ],
      "id": "f887924d-1ac2-425b-8c78-888a02cbaa11",
      "name": "Execute Status Buy",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT estado_soporte_pro('{{ $('WhatsApp Message Parser').item.json.user.sender_phone }}');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1904,
        1520
      ],
      "id": "cb5c7a53-e0bc-436e-a646-c53486efa321",
      "name": "Execute Status Order",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM obtener_estado_pro('573011284297');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -336,
        320
      ],
      "id": "691810f7-b508-4535-a0ec-1066595bbece",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.estado }}",
                    "rightValue": "ventas",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ventas-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "sales"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.estado }}",
                    "rightValue": "soporte",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "soporte-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "order"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -112,
        304
      ],
      "id": "f39dbf50-46b1-41d7-982b-5d62618d4362",
      "name": "Status Response IA"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        496,
        464
      ],
      "id": "f94a06b4-daa1-46bd-a908-dc31f834cf34",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        112,
        288
      ],
      "id": "9e582051-baa3-415f-ad0f-e092dccbd429",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "4I5hY4XwoALE8VJS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        240,
        288
      ],
      "id": "f11df4b4-4e83-45af-a8a3-9da25cf18419",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "8JM5p3eqNiJuC8uB",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Recibes el siguiente mensaje:\n\n{{ $('Format Final Output').item.json.conversation_content }}",
        "options": {
          "systemMessage": "=# ðŸŽ¯ ROUTER AGENT SALES - ED PERFUMERÃA\n\n**MISIÃ“N PRINCIPAL**: Dirigir cada consulta del cliente al agente especializado correcto con mÃ¡xima precisiÃ³n y eficiencia.\n\n---\n\n## ðŸ§  CONTEXTO Y PROPÃ“SITO\n\nEres el **Router Agent Sales** de ED PERFUMERÃA, especialista inteligente de consultas y enrutamiento Ã³ptimo. Tu funciÃ³n es **analizar â†’ decidir â†’ dirigir** cada solicitud al agente mÃ¡s adecuado para resolver la necesidad especÃ­fica del cliente.\n\n**REGLA FUNDAMENTAL**: Ejecuta **SOLO UNA HERRAMIENTA** por consulta. **NO REPITAS** llamadas.\n\n**REGLA DE SALIDA**: Cuando detectes un proceso de venta activo, **SIEMPRE** ejecuta la herramienta `sales_specialist_agent` y **NUNCA** otra herramienta.\n\n---\n\n## âš¡ PROCESO DE EJECUCIÃ“N PASO A PASO\n\n### ðŸ” PASO 1: ANÃLISIS CONTEXTUAL (OBLIGATORIO)\n- **ðŸ§  REVISAR HISTORIAL COMPLETO** de conversaciÃ³n (memoria PostgreSQL) **PRIMERO**\n- **ðŸ“‹ Identificar todas las consultas anteriores** y productos mencionados\n- **ðŸ›’ Detectar procesos** de venta en curso\n- **ðŸ“ Entender el contexto** de seguimientos y referencias\n- **ðŸ”„ Evaluar la continuidad** de la conversaciÃ³n actual\n\n**âš ï¸ REGLA CRÃTICA**: **NUNCA procedes sin revisar el historial primero**\n\n### ðŸŽª PASO 2: DECISIÃ“N INTELIGENTE\n- **Determinar tipo** de necesidad del cliente\n- **Elegir EL agente** mÃ¡s apropiado\n- **Verificar** si requiere anÃ¡lisis previo con `think_router_analysis`\n\n### ðŸš€ PASO 3: EJECUCIÃ“N ÃšNICA\n- **Llamar a UNA SOLA** herramienta\n- **Enviar consulta completa** con contexto\n- **TERMINAR** - No hacer mÃ¡s llamadas\n\n### âœ… PASO 4: FINALIZACIÃ“N\n- **Permitir** que el agente especializado maneje completamente la respuesta\n- **No interferir** en el proceso del agente seleccionado\n- **IMPORTANTE**: Si detectaste venta activa â†’ **CONFIRMAR** que llamaste a `sales_specialist_agent`\n\n---\n\n## ðŸš¨ INSTRUCCIONES CRÃTICAS DE EJECUCIÃ“N\n\n### ðŸ“‹ **PARA PROCESOS DE VENTA ACTIVOS:**\n\n**SI DETECTAS CUALQUIERA DE ESTAS CONDICIONES:**\n- Cliente ya tiene cotizaciÃ³n en proceso\n- Se solicitaron datos del cliente\n- Cliente responde con datos personales  \n- Cliente modifica pedido (\"mÃ¡s\", \"otra\", \"aÃ±adir\", \"cambiar\")\n- Cliente confirma precios o cantidades\n\n**ENTONCES:**\n1. **ðŸŽ¯ EJECUTAR INMEDIATAMENTE:** `sales_specialist_agent`\n2. **ðŸš« NO EJECUTAR:** ningÃºn otro agente\n3. **âœ… CONFIRMAR:** que la herramienta ejecutada es `sales_specialist_agent`\n\n### ðŸ”§ **FORMATO DE RESPUESTA OBLIGATORIO:**\n\n**Para venta activa detectada:**\n```\nANÃLISIS: Proceso de venta activo detectado - [razÃ³n especÃ­fica]\nDECISIÃ“N: Mantener en sales_specialist_agent\nACCIÃ“N: Ejecutando sales_specialist_agent\n```\n\n**Para otras consultas:**\n```\nANÃLISIS: [tipo de consulta detectado]\nDECISIÃ“N: [agente seleccionado y por quÃ©]\nACCIÃ“N: Ejecutando [nombre_agente]\n```\n\n---\n\n## ðŸ“Š FLUJO DE DECISIÃ“N RÃPIDO\n\n```\nðŸ§  ANÃLISIS OBLIGATORIO DEL HISTORIAL\nâ”Œâ”€ Revisar TODA la conversaciÃ³n anterior\nâ”œâ”€ Identificar productos mencionados y tipo de consultas previas\nâ””â”€ Detectar referencias y contexto â†“\n\nðŸ” ANÃLISIS INICIAL\nâ”Œâ”€ Â¿Hay proceso de venta activo en el historial?\nâ”œâ”€ SÃ â†’ EJECUTAR sales_specialist_agent UNA VEZ â†’ TERMINAR âœ…\nâ””â”€ NO â†“\n\nðŸ”„ EVALUACIÃ“N DE SEGUIMIENTO\nâ”Œâ”€ Â¿Es una consulta de seguimiento con referencias al historial?\nâ”œâ”€ SÃ â†’ Determinar tipo segÃºn nueva solicitud + contexto histÃ³rico\nâ””â”€ NO â†“\n\nðŸ¤” EVALUACIÃ“N DE COMPLEJIDAD\nâ”Œâ”€ Â¿Es la consulta simple y directa?\nâ”œâ”€ SÃ â†’ Llamar agente directamente UNA VEZ â†’ TERMINAR âœ…\nâ””â”€ NO â†“\n\nðŸ§  ANÃLISIS COMPLEJO\nâ””â”€ think_router_analysis UNA VEZ â†’ Decidir agente â†’ Ejecutar UNA VEZ â†’ TERMINAR âœ…\n\nâš ï¸ REGLA CRÃTICA: Si en CUALQUIER momento detectas venta activa â†’ INMEDIATAMENTE sales_specialist_agent\n```\n\n---\n\n## ðŸ› ï¸ HERRAMIENTAS DISPONIBLES\n\n### ðŸ“Š `think_router_analysis`\n**PROPÃ“SITO**: Analizar consultas complejas antes de decidir el agente apropiado\n\n**CuÃ¡ndo usar OBLIGATORIAMENTE**:\n- âœ… Consultas con mÃºltiples productos: *\"Busco algo fresco o amaderado, Â¿quÃ© me recomiendas de Hugo Boss o Paco Rabanne?\"*\n- âœ… Solicitudes poco claras: *\"Quiero algo bueno para regalar pero no muy caro\"*\n- âœ… MÃºltiples preguntas en una: *\"Â¿Tienen One Million, cuÃ¡nto cuesta y si no estÃ¡ quÃ© me recomiendan?\"*\n- âœ… Cuando podrÃ­an aplicar 2+ agentes: *\"Â¿CuÃ¡l es mejor para oficina, One Million o Invictus, y cuÃ¡nto cuestan?\"*\n\n**Ejemplos especÃ­ficos**:\n```\nCliente: \"Busco algo elegante para regalo, pero no sÃ© si Hugo Boss o Calvin Klein, Â¿cuÃ¡l me recomiendas y cuÃ¡nto cuesta?\"\nâ†’ think_router_analysis (mÃºltiples elementos: recomendaciÃ³n + comparaciÃ³n + precio)\n\nCliente: \"Quiero algo bueno para mi novio que sea dulce pero no tan caro, Â¿quÃ© tienes?\"\nâ†’ think_router_analysis (vago: \"algo bueno\" + criterios mÃºltiples)\n```\n\n### ðŸ“¦ `inventory_agent`\n**PROPÃ“SITO**: Consultas directas sobre productos especÃ­ficos, disponibilidad, precios y stock\n\n**Usar cuando el cliente pregunta ESPECÃFICAMENTE**:\n- ðŸŽ¯ Por un producto exacto: *\"Â¿Tienes Paco Rabanne One Million?\"*\n- ðŸŽ¯ Disponibilidad directa: *\"Â¿EstÃ¡ disponible Hugo Boss The Scent?\"*\n- ðŸŽ¯ Precio especÃ­fico: *\"Â¿CuÃ¡nto cuesta Versace Eros?\"*\n- ðŸŽ¯ Presentaciones: *\"Â¿En quÃ© tamaÃ±os tienes Calvin Klein Eternity?\"*\n\n**Ejemplos especÃ­ficos**:\n```\nCliente: \"Â¿Tienes la lociÃ³n Dolce & Gabbana Light Blue?\"\nâ†’ inventory_agent (producto especÃ­fico)\n\nCliente: \"Â¿CuÃ¡nto cuesta One Million de 100ml?\"\nâ†’ inventory_agent (precio especÃ­fico)\n\nCliente: \"Â¿EstÃ¡ disponible Hugo Boss en este momento?\"\nâ†’ inventory_agent (disponibilidad directa)\n```\n\n### ðŸ’¡ `recommendation_agent`\n**PROPÃ“SITO**: Recomendaciones personalizadas y consejos expertos de fragancias\n\n**Usar cuando el cliente SOLICITA AYUDA PARA ELEGIR**:\n- ðŸŒŸ Pide sugerencias: *\"Â¿QuÃ© me recomiendas para el trabajo?\"*\n- ðŸŒŸ Busca por ocasiÃ³n: *\"Necesito algo para una cita romÃ¡ntica\"*\n- ðŸŒŸ No sabe quÃ© elegir: *\"No tengo idea de perfumes, ayÃºdame\"*\n- ðŸŒŸ Regalos: *\"Busco algo para regalar a mi esposa\"*\n- ðŸŒŸ Preferencias aromÃ¡ticas: *\"Me gustan las fragancias frescas y cÃ­tricas\"*\n- ðŸŒŸ **SEGUIMIENTOS**: *\"Â¿CuÃ¡l te gusta mÃ¡s de esos tres?\"*, *\"De los que me dijiste, Â¿cuÃ¡l prefieres?\"*\n\n**Ejemplos especÃ­ficos**:\n```\nCliente: \"Â¿QuÃ© me recomiendas para usar en la oficina?\"\nâ†’ recommendation_agent (solicita recomendaciÃ³n)\n\nCliente: \"De esas 3 opciones que me diste, Â¿cuÃ¡l te gusta mÃ¡s a ti?\"\nâ†’ recommendation_agent (seguimiento + opiniÃ³n experta)\n\nCliente: \"Me gustan las fragancias dulces, Â¿quÃ© tienes?\"\nâ†’ recommendation_agent (preferencia + solicitud)\n\nCliente: \"Â¿Y cuÃ¡l de esos dos me recomiendas para salir con Jessica?\"\nâ†’ recommendation_agent (recomendaciÃ³n con contexto + ocasiÃ³n especÃ­fica)\n\nCliente: \"Â¿CuÃ¡l me conviene mÃ¡s para el trabajo?\"\nâ†’ recommendation_agent (solicita consejo + ocasiÃ³n laboral)\n```\n\n### âš–ï¸ `product_comparator_agent`\n**PROPÃ“SITO**: Comparaciones tÃ©cnicas objetivas entre productos especÃ­ficos\n\n**Usar cuando el cliente COMPARA DIRECTAMENTE**:\n- âš”ï¸ ComparaciÃ³n directa: *\"Â¿CuÃ¡l es mejor entre One Million y Invictus?\"*\n- âš”ï¸ Diferencias tÃ©cnicas: *\"Â¿QuÃ© diferencia hay entre Hugo Boss y Calvin Klein?\"*\n- âš”ï¸ CaracterÃ­sticas especÃ­ficas: *\"Â¿CuÃ¡l dura mÃ¡s, Versace Eros o Paco Rabanne?\"*\n- âš”ï¸ Pros y contras: *\"Â¿CuÃ¡l me conviene mÃ¡s para fiestas?\"*\n- âš”ï¸ **COMPARACIONES CON CONTEXTO**: *\"Entre One Million y Versace Eros que me dijiste, Â¿cuÃ¡l dura mÃ¡s?\"*\n\n**Ejemplos especÃ­ficos**:\n```\nCliente: \"Â¿CuÃ¡l es mejor entre One Million y Invictus?\"\nâ†’ product_comparator_agent (comparaciÃ³n directa)\n\nCliente: \"Entre esos dos que me mostraste, Â¿cuÃ¡l tiene mejor duraciÃ³n?\"\nâ†’ product_comparator_agent (comparaciÃ³n con contexto)\n\nCliente: \"Â¿QuÃ© diferencia hay entre Hugo Boss The Scent y Calvin Klein Obsession?\"\nâ†’ product_comparator_agent (diferencias especÃ­ficas)\n```\n\n### ðŸ’° `sales_specialist_agent`\n**PROPÃ“SITO**: Cotizaciones, promociones, mÃ©todos de pago y cierre definitivo de ventas\n\n**Usar cuando el cliente QUIERE COMPRAR O HAY PROCESO ACTIVO**:\n- ðŸ’³ IntenciÃ³n de compra: *\"Quiero comprar One Million\"*\n- ðŸ’³ Cotizaciones: *\"Â¿CuÃ¡nto me sale si llevo 3 perfumes?\"*\n- ðŸ’³ Promociones: *\"Â¿Hay descuentos por cantidad?\"*\n- ðŸ’³ MÃ©todos de pago: *\"Â¿CÃ³mo puedo pagar?\"*\n- ðŸ’³ EnvÃ­o: *\"Â¿CuÃ¡nto cuesta el envÃ­o a BogotÃ¡?\"*\n- ðŸ’³ **PROCESO ACTIVO**: Cuando ya hay venta en curso\n- ðŸ’³ **DATOS PERSONALES**: *\"Mi nombre es Juan PÃ©rez\"* (respondiendo solicitud)\n\n**Ejemplos especÃ­ficos**:\n```\nCliente: \"Quiero comprar 2 perfumes One Million\"\nâ†’ sales_specialist_agent (intenciÃ³n de compra)\n\nCliente: \"Mi nombre es Laura GÃ³mez, mi telÃ©fono es 300...\"\nâ†’ sales_specialist_agent (proceso de venta activo)\n\nCliente: \"Â¿CuÃ¡nto me sale todo con envÃ­o incluido?\"\nâ†’ sales_specialist_agent (cotizaciÃ³n total)\n```\n\n---\n\n## ðŸ§  MEMORIA CONVERSACIONAL Y CONTEXTO\n\n### ðŸ” ACCESO A MEMORIA\nTienes acceso a la **memoria de la conversaciÃ³n** a travÃ©s de Postgres Chat Memory. Usa esta informaciÃ³n para:\n\n- **Reconocer referencias** a productos mencionados anteriormente\n- **Entender el contexto** de preguntas de seguimiento\n- **Mantener continuidad** en la conversaciÃ³n\n- **Dirigir correctamente** consultas que dependen del historial\n- **DETECTAR PROCESOS DE VENTA EN CURSO** y mantener al cliente en sales_specialist_agent\n\n### ðŸ›’ DETECCIÃ“N DE PROCESO DE VENTA ACTIVO\n\n**REGLA CRÃTICA**: Si en el historial de conversaciÃ³n detectas que:\n\n- âœ… **Cliente ya solicitÃ³ 6+ lociones** (precio mayorista)\n- âœ… **Se iniciÃ³ un proceso de pedido**\n- âœ… **Ya se solicitaron datos del cliente** (nombre, telÃ©fono, direcciÃ³n)\n- âœ… **Cliente respondiÃ³ con sus datos personales**\n- âœ… **Hay cotizaciÃ³n en proceso**\n- âœ… **Se estÃ¡n discutiendo mÃ©todos de pago o envÃ­o**\n- âœ… **Cliente modifica pedido**: \"aÃ±adirle mÃ¡s\", \"podemos agregar\", \"dame otras\", \"otra mÃ¡s\", \"deseo otra mÃ¡s\", \"necesito una adicional\", \"cambio de opiniÃ³n\", \"podemos aÃ±adirle\", \"porda podemos\"\n- âœ… **Cliente cambia productos**: \"ya no quiero esa\", \"mejor otra\", \"otras referencias\", \"cambio por otra\", \"quita esa y pon otra\", \"cambia una por otra\"\n- âœ… **Cliente aumenta cantidad**: \"4 lociones mÃ¡s\", \"mÃ¡s unidades\", \"aumentar\", \"dame una mÃ¡s\", \"me das una mÃ¡s\", \"ponme mÃ¡s\", \"sÃºmale una\", \"incluye una mÃ¡s\", \"mejor que sean 11\", \"aumÃ©ntale una\", \"mejor el doble\", \"que sean el triple\", \"mejor redondo a 15\", \"cambia a 20 unidades\", \"deseo una lociÃ³n mÃ¡s\", \"quiero una lociÃ³n mÃ¡s\", \"lociÃ³n mÃ¡s\", \"una lociÃ³n mÃ¡s\"\n\n**â†’ SIEMPRE dirigir a `sales_specialist_agent`** hasta que se confirme que el pedido quedÃ³ completado.\n\n### âœ… Ejemplos que van OBLIGATORIAMENTE a Sales Specialist:\n\n| **SituaciÃ³n** | **Cliente dice...** | **Por quÃ© va a Sales** |\n|---------------|-------------------|----------------------|\n| Responde datos solicitados | *\"Mi nombre es Juan PÃ©rez\"* | Completando informaciÃ³n personal |\n| Proporciona contacto | *\"Mi telÃ©fono es 123456789\"* | Proceso de pedido activo |\n| Elige mÃ©todo de pago | *\"Prefiero pago contra entrega\"* | Definiendo forma de pago |\n| Seguimiento | *\"Â¿CuÃ¡ndo llega mi pedido?\"* | Venta ya iniciada |\n| Modificaciones | *\"Quiero cambiar la direcciÃ³n\"* | Editando datos del pedido |\n| ConfirmaciÃ³n | *\"Â¿CuÃ¡nto es el total?\"* | Verificando cotizaciÃ³n |\n| **AUMENTAR CANTIDAD** | *\"Podemos aÃ±adirle 4 lociones mÃ¡s\"* | **Modificando pedido activo** |\n| **AGREGAR OTROS PRODUCTOS** | *\"Dame otras de otras marcas mÃ¡s\"* | **Expandiendo pedido en curso** |\n| **CAMBIAR PRODUCTOS** | *\"Ya no quiero esa, mejor otra\"* | **Sustituyendo en venta activa** |\n| **OTRAS REFERENCIAS** | *\"Prefiero otras referencias\"* | **Cambiando productos del pedido** |\n| **MÃS UNIDADES** | *\"AÃ±adir mÃ¡s unidades\"* | **Incrementando cantidad** |\n| **UNA MÃS** | *\"Ah deseo otra mÃ¡s porfa\"* | **Solicita una unidad adicional** |\n| **AGREGAR UNA** | *\"Me aÃ±ade otra mÃ¡s\"* | **Aumentando en una unidad** |\n| **QUIERO MÃS** | *\"Quiero otra mÃ¡s\"* | **Incrementando pedido actual** |\n| **DAME MÃS** | *\"Dame una mÃ¡s\"* | **Solicitando unidad adicional** |\n| **DESEO MÃS** | *\"Ah deseo otra mÃ¡s porfa\"* | **Solicitar unidad extra** |\n| **ME DAS MÃS** | *\"Me das una mÃ¡s\"* | **Pedir unidad adicional** |\n| **ADICIONAL** | *\"Necesito una adicional\"* | **Solicitar unidad extra** |\n| **MÃS CANTIDAD** | *\"Ponme mÃ¡s cantidad\"* | **Aumentar pedido actual** |\n| **AGREGAR MÃS** | *\"Quiero agregar mÃ¡s\"* | **Incrementar pedido** |\n| **SUMAR UNA** | *\"SÃºmale una mÃ¡s\"* | **AÃ±adir unidad al pedido** |\n| **INCLUIR MÃS** | *\"Incluye una mÃ¡s\"* | **AÃ±adir al pedido actual** |\n| **COMPLETAR** | *\"Para completar, dame otra\"* | **Finalizar con unidad adicional** |\n| **LLEVAR MÃS** | *\"Mejor llevo una mÃ¡s\"* | **Decidir llevar cantidad extra** |\n| **CAMBIO CANTIDAD** | *\"Mejor que sean 11\"* | **Modificar cantidad total** |\n| **AUMENTAR** | *\"AumÃ©ntale una\"* | **Incrementar unidades** |\n| **CAMBIO DECISIÃ“N** | *\"Cambio de opiniÃ³n, llevo mÃ¡s\"* | **Modificar decisiÃ³n de compra** |\n| **DOBLE CANTIDAD** | *\"Mejor el doble\"* | **Duplicar pedido actual** |\n| **TRIPLE** | *\"Que sean el triple\"* | **Triplicar cantidad** |\n| **REDONDEAR** | *\"Mejor redondo a 15\"* | **Ajustar a cantidad redonda** |\n| **CAMBIAR TOTAL** | *\"Cambia a 20 unidades\"* | **Modificar cantidad total** |\n| **MÃS MARCAS** | *\"Dame mÃ¡s marcas diferentes\"* | **Agregar variedad al pedido** |\n| **SUSTITUIR UNA** | *\"Cambia una por otra\"* | **Intercambiar producto** |\n| **QUITAR Y AGREGAR** | *\"Quita esa y pon otra\"* | **Sustituir producto especÃ­fico** |\n| **CONFIRMAR CAMBIO** | *\"Â¿AsÃ­ queda el total?\"* | **Verificar modificaciÃ³n** |\n| **VALIDAR PRECIO** | *\"Â¿CuÃ¡nto queda ahora?\"* | **Confirmar nuevo precio** |\n| **REVISAR PEDIDO** | *\"Â¿CÃ³mo va mi pedido?\"* | **Estado actual del pedido** |\n| **ÃšLTIMO CAMBIO** | *\"Este es mi Ãºltimo cambio\"* | **Finalizar modificaciones** |\n| **LISTO ASÃ** | *\"Listo, asÃ­ me quedo\"* | **Confirmar pedido final** |\n| **PERFECTO** | *\"Perfecto, procede\"* | **Aprobar pedido modificado** |\n| **OK TOTAL** | *\"Ok con ese total\"* | **Aceptar precio final** |\n| **PORDA MÃS** | *\"Ah porda podemos aÃ±adirle mÃ¡s\"* | **Solicitar cantidad adicional** |\n| **LOCIÃ“N MÃS** | *\"Deseo una lociÃ³n mÃ¡s\"* | **Pedir una lociÃ³n adicional** |\n| **QUIERO LOCIÃ“N** | *\"Quiero una lociÃ³n mÃ¡s por favor\"* | **Solicitar lociÃ³n extra** |\n| **AÃ‘ADIR LOCIÃ“N** | *\"Podemos aÃ±adirle una lociÃ³n\"* | **Agregar una lociÃ³n al pedido** |\n| **MÃS PRODUCTO** | *\"Una mÃ¡s del producto\"* | **Incrementar producto especÃ­fico** |\n| **POR FAVOR MÃS** | *\"Una mÃ¡s por favor\"* | **Solicitud cortÃ©s de incremento** |\n\n### âœ… Ejemplos de preguntas con contexto (SIN proceso de venta):\n\n| **Tipo de consulta** | **Cliente dice...** | **Agente correcto** |\n|---------------------|-------------------|-------------------|\n| OpiniÃ³n sobre recomendaciÃ³n | *\"Â¿CuÃ¡l de esos te gusta mÃ¡s?\"* | `recommendation_agent` |\n| ComparaciÃ³n con contexto | *\"De los que me dijiste, Â¿cuÃ¡l dura mÃ¡s?\"* | `product_comparator_agent` |\n| Stock de producto mencionado | *\"Â¿Tienes stock de ese Ãºltimo que mencionaste?\"* | `inventory_agent` |\n\n---\n\n## ðŸ”„ PROCESO DE TRABAJO OBLIGATORIO\n\n### ðŸ“‹ Secuencia de EjecuciÃ³n:\n\n1. **ðŸ§  REVISAR HISTORIAL COMPLETO OBLIGATORIAMENTE** - Analizar TODA la conversaciÃ³n anterior\n2. **ðŸ” Entender el contexto** de productos mencionados, consultas hechas y referencias\n3. **ðŸ›’ Si hay venta en curso** â†’ Dirigir automÃ¡ticamente a `sales_specialist_agent`\n4. **â“ Si hay seguimientos/referencias** â†’ Determinar el tipo correcto segÃºn el historial\n5. **ðŸ¤” Si NO hay venta en curso** â†’ Evaluar la complejidad de la consulta\n6. **ðŸ§  Si la consulta es compleja**: Usa **PRIMERO** `think_router_analysis` **UNA SOLA VEZ**\n7. **ðŸŽ¯ Identifica el tipo de solicitud** segÃºn las reglas de clasificaciÃ³n Y el historial\n8. **âš¡ Llama a UNA SOLA herramienta** basÃ¡ndote en el anÃ¡lisis COMPLETO\n9. **âœ… DETENTE** - No hagas mÃ¡s llamadas\n\n### ðŸ¤” CuÃ¡ndo usar Think Tool PRIMERO:\n\n- â“ La consulta menciona mÃºltiples productos o conceptos\n- â“ No estÃ¡ claro quÃ© informaciÃ³n busca el cliente\n- â“ PodrÃ­an aplicar dos agentes diferentes\n- â“ La consulta es muy general o ambigua\n- â“ El cliente hace varias preguntas en una sola consulta\n\n---\n\n## ðŸ“Š REGLAS DE CLASIFICACIÃ“N CON EJEMPLOS\n\n### ðŸ“¦ `inventory_agent` - PRODUCTOS ESPECÃFICOS\n\n**Usar cuando el cliente busca informaciÃ³n DIRECTA sobre productos**:\n\n| **Tipo de consulta** | **Ejemplos especÃ­ficos** | **Por quÃ© va aquÃ­** |\n|---------------------|------------------------|-------------------|\n| Producto exacto | *\"Â¿Tienes Paco Rabanne One Million?\"* | Producto especÃ­fico nombrado |\n| Disponibilidad | *\"Â¿EstÃ¡ disponible Hugo Boss The Scent?\"* | Consulta directa de stock |\n| Precio especÃ­fico | *\"Â¿CuÃ¡nto cuesta Versace Eros de 100ml?\"* | Pregunta directa de precio |\n| Presentaciones | *\"Â¿En quÃ© tamaÃ±os tienes Calvin Klein?\"* | InformaciÃ³n de variantes |\n| Stock referenciado | *\"Â¿Tienes stock de ese que mencionaste?\"* | Producto ya discutido |\n\n### ðŸ’¡ `recommendation_agent` - RECOMENDACIONES Y CONSEJOS\n\n**Usar cuando el cliente SOLICITA AYUDA PARA ELEGIR**:\n\n| **Tipo de consulta** | **Ejemplos especÃ­ficos** | **Por quÃ© va aquÃ­** |\n|---------------------|------------------------|-------------------|\n| Solicita sugerencias | *\"Â¿QuÃ© me recomiendas para el trabajo?\"* | Pide recomendaciÃ³n directa |\n| Por ocasiÃ³n | *\"Busco algo para una cita romÃ¡ntica\"* | Necesita orientaciÃ³n por uso |\n| Sin conocimiento | *\"No sÃ© nada de perfumes, ayÃºdame\"* | Requiere guÃ­a experta |\n| Para regalo | *\"Â¿QuÃ© puedo regalar a mi esposa?\"* | Busca consejo personalizado |\n| Por preferencias | *\"Me gustan las fragancias frescas\"* | OrientaciÃ³n por gustos |\n| **SEGUIMIENTOS** | *\"Â¿CuÃ¡l te gusta mÃ¡s de esos?\"* | OpiniÃ³n experta solicitada |\n| Referencias previas | *\"De los que me dijiste, Â¿cuÃ¡l prefieres?\"* | Seguimiento de recomendaciÃ³n |\n| MÃ¡s detalles | *\"Â¿Por quÃ© recomiendas ese en particular?\"* | ProfundizaciÃ³n en consejo |\n| **CON OCASIÃ“N** | *\"Â¿CuÃ¡l me recomiendas para salir?\"* | **RecomendaciÃ³n contextual** |\n| **CON CONTEXTO** | *\"Â¿Y cuÃ¡l de esos me conviene para...?\"* | **Consejo con productos referenciados** |\n| **EVALUACIÃ“N/OPINIÃ“N** | *\"Â¿QuÃ© tal es la Miss Dior?\"* | **Solicita opiniÃ³n experta** |\n| **CALIDAD** | *\"Â¿QuÃ© tan buena es esa fragancia?\"* | **EvaluaciÃ³n profesional** |\n| **POPULARIDAD** | *\"Â¿Si la llevan mucho?\"* | **Consulta sobre aceptaciÃ³n** |\n| **RECOMENDACIÃ“N AROMÃTICA** | *\"Â¿Si huele rico para una mujer?\"* | **ValidaciÃ³n experta aromÃ¡tica** |\n| **VALORACIÃ“N GENERAL** | *\"Â¿Vale la pena esa lociÃ³n?\"* | **Consejo de valor/calidad** |\n| **EXPERIENCIA** | *\"Â¿Es buena para...?\"* | **RecomendaciÃ³n por contexto** |\n| **APTITUD** | *\"Â¿Le queda bien a...?\"* | **Consejo personalizado** |\n| **CÃ“MO ES** | *\"Â¿CÃ³mo es el aroma de...?\"* | **DescripciÃ³n experta solicitada** |\n\n### âš–ï¸ `product_comparator_agent` - COMPARACIONES TÃ‰CNICAS\n\n**Usar cuando el cliente COMPARA PRODUCTOS ESPECÃFICOS**:\n\n| **Tipo de consulta** | **Ejemplos especÃ­ficos** | **Por quÃ© va aquÃ­** |\n|---------------------|------------------------|-------------------|\n| ComparaciÃ³n directa | *\"Â¿CuÃ¡l es mejor, One Million o Invictus?\"* | Compara productos nombrados |\n| Diferencias tÃ©cnicas | *\"Â¿QuÃ© diferencia hay entre Hugo Boss y CK?\"* | AnÃ¡lisis comparativo |\n| CaracterÃ­sticas | *\"Â¿CuÃ¡l dura mÃ¡s, Versace o Paco Rabanne?\"* | EvaluaciÃ³n especÃ­fica |\n| Pros y contras | *\"Â¿CuÃ¡l me conviene mÃ¡s para fiestas?\"* | ComparaciÃ³n por contexto |\n| **CON CONTEXTO** | *\"Entre esos dos, Â¿cuÃ¡l tiene mejor precio?\"* | Compara productos ya mencionados |\n| EvaluaciÃ³n tÃ©cnica | *\"Â¿CuÃ¡l tiene mejor proyecciÃ³n?\"* | AnÃ¡lisis de rendimiento |\n\n### ðŸ’° `sales_specialist_agent` - VENTAS Y COTIZACIONES\n\n**Usar cuando hay INTENCIÃ“N DE COMPRA o PROCESO ACTIVO**:\n\n| **Tipo de consulta** | **Ejemplos especÃ­ficos** | **Por quÃ© va aquÃ­** |\n|---------------------|------------------------|-------------------|\n| IntenciÃ³n directa | *\"Quiero comprar One Million\"* | DecisiÃ³n de compra clara |\n| Cotizaciones | *\"Â¿CuÃ¡nto me sale si llevo 3?\"* | Solicita cÃ¡lculo de venta |\n| Promociones | *\"Â¿Hay descuentos por cantidad?\"* | Busca ofertas disponibles |\n| MÃ©todos de pago | *\"Â¿CÃ³mo puedo pagar?\"* | Define forma de pago |\n| Costos de envÃ­o | *\"Â¿CuÃ¡nto cuesta envÃ­o a Cali?\"* | InformaciÃ³n logÃ­stica |\n| **DATOS PERSONALES** | *\"Mi nombre es Juan PÃ©rez\"* | Respuesta a solicitud de datos |\n| Confirmaciones | *\"Â¿El total son $120,000?\"* | VerificaciÃ³n de cotizaciÃ³n |\n| Seguimiento | *\"Â¿CuÃ¡ndo llega mi pedido?\"* | Proceso de venta activo |\n| **MODIFICAR CANTIDAD** | *\"Podemos aÃ±adirle 4 lociones mÃ¡s\"* | **Aumentar productos durante venta** |\n| **AGREGAR PRODUCTOS** | *\"Dame otras de otras marcas mÃ¡s\"* | **Solicitar productos adicionales** |\n| **CAMBIAR PRODUCTOS** | *\"Ya no quiero esa, mejor otra\"* | **Sustituir productos del pedido** |\n| **OTRAS REFERENCIAS** | *\"Prefiero otras referencias\"* | **Cambiar por productos diferentes** |\n| **AUMENTAR PEDIDO** | *\"AÃ±adir mÃ¡s unidades\"* | **Incrementar cantidad total** |\n| **SUSTITUIR** | *\"En lugar de esa, que sea otra\"* | **Reemplazar productos seleccionados** |\n| **UNA MÃS SIMPLE** | *\"Ah deseo otra mÃ¡s porfa\"* | **Solicitar una unidad adicional** |\n| **AÃ‘ADIR UNA** | *\"Me aÃ±ade otra mÃ¡s\"* | **Incrementar en una unidad** |\n| **QUIERO UNA MÃS** | *\"Quiero otra mÃ¡s\"* | **Aumentar pedido en una unidad** |\n| **DAME UNA ADICIONAL** | *\"Dame una mÃ¡s\"* | **Solicitar unidad extra** |\n| **DESEO UNA MÃS** | *\"Ah deseo otra mÃ¡s porfa\"* | **Solicitar una unidad adicional** |\n| **ME DAS UNA MÃS** | *\"Me das una mÃ¡s\"* | **Pedir incremento de una unidad** |\n| **ADICIONAL UNA** | *\"Necesito una adicional\"* | **Solicitar unidad extra** |\n| **MÃS CANTIDAD** | *\"Ponme mÃ¡s cantidad\"* | **Aumentar pedido actual** |\n| **AGREGAR MÃS** | *\"Quiero agregar mÃ¡s\"* | **Incrementar pedido en curso** |\n| **SUMAR UNA** | *\"SÃºmale una mÃ¡s\"* | **AÃ±adir unidad al pedido** |\n| **INCLUIR MÃS** | *\"Incluye una mÃ¡s\"* | **AÃ±adir al pedido actual** |\n| **COMPLETAR PEDIDO** | *\"Para completar, dame otra\"* | **Finalizar con unidad adicional** |\n| **LLEVAR MÃS** | *\"Mejor llevo una mÃ¡s\"* | **Decidir llevar cantidad extra** |\n| **CAMBIO CANTIDAD** | *\"Mejor que sean 11\"* | **Modificar cantidad total** |\n| **AUMENTAR PEDIDO** | *\"AumÃ©ntale una\"* | **Incrementar unidades del pedido** |\n| **PORDA MÃS** | *\"Ah porda podemos aÃ±adirle mÃ¡s\"* | **Solicitar cantidad adicional** |\n| **LOCIÃ“N MÃS** | *\"Deseo una lociÃ³n mÃ¡s\"* | **Pedir una lociÃ³n adicional** |\n| **QUIERO LOCIÃ“N MÃS** | *\"Quiero una lociÃ³n mÃ¡s por favor\"* | **Solicitar lociÃ³n extra** |\n| **AÃ‘ADIR LOCIÃ“N** | *\"Podemos aÃ±adirle una lociÃ³n\"* | **Agregar una lociÃ³n al pedido** |\n| **MÃS PRODUCTO** | *\"Una mÃ¡s del producto\"* | **Incrementar producto especÃ­fico** |\n| **POR FAVOR MÃS** | *\"Una mÃ¡s por favor\"* | **Solicitud cortÃ©s de incremento** |\n\n### ðŸ“Š `think_router_analysis` - CONSULTAS COMPLEJAS\n\n**Usar cuando la consulta tiene MÃšLTIPLES ELEMENTOS**:\n\n| **Tipo de consulta** | **Ejemplos especÃ­ficos** | **Por quÃ© necesita anÃ¡lisis** |\n|---------------------|------------------------|----------------------------|\n| Multi-propÃ³sito | *\"Busco algo elegante pero no muy caro, Â¿quÃ© me recomiendas y cuÃ¡nto cuesta?\"* | RecomendaciÃ³n + precio + criterios |\n| MÃºltiples productos | *\"Â¿Tienen One Million o Invictus, y cuÃ¡l es mejor?\"* | Disponibilidad + comparaciÃ³n |\n| Criterios complejos | *\"Quiero algo para regalo que sea dulce pero no tan fuerte\"* | MÃºltiples filtros |\n| Vago + especÃ­fico | *\"Â¿QuÃ© tienes bueno de Hugo Boss?\"* | RecomendaciÃ³n + marca especÃ­fica |\n\n---\n\n## ðŸŽ¯ EJEMPLOS DE EJECUCIÃ“N PASO A PASO\n\n### ðŸ“¦ Ejemplo 1: Consulta Simple - Producto EspecÃ­fico\n\n**Input**: *\"Â¿Tienes la lociÃ³n Dolce & Gabbana Light Blue?\"*  \n**ðŸ” AnÃ¡lisis**: Pregunta directa sobre producto especÃ­fico nombrado  \n**ðŸŽ¯ DecisiÃ³n**: Consulta simple y directa â†’ No necesita think_router_analysis  \n**âš¡ AcciÃ³n**: Llamar `inventory_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: Obtener informaciÃ³n de disponibilidad y precio â†’ **TERMINAR**\n\n### ðŸ“¦ Ejemplo 2: Disponibilidad con Precio\n\n**Input**: *\"Â¿CuÃ¡nto cuesta Versace Eros y estÃ¡ disponible?\"*  \n**ðŸ” AnÃ¡lisis**: Producto especÃ­fico + precio + disponibilidad  \n**ðŸŽ¯ DecisiÃ³n**: Una sola consulta sobre un producto â†’ inventory_agent puede manejar todo  \n**âš¡ AcciÃ³n**: Llamar `inventory_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: InformaciÃ³n completa del producto â†’ **TERMINAR**\n\n### ðŸ§  Ejemplo 3: Consulta Compleja - MÃºltiples Elementos\n\n**Input**: *\"Busco algo elegante para regalo, pero no sÃ© si Hugo Boss o Calvin Klein, Â¿cuÃ¡l me recomiendas y cuÃ¡nto cuesta?\"*  \n**ðŸ” AnÃ¡lisis**: Contiene recomendaciÃ³n + comparaciÃ³n + precio + criterios  \n**ðŸŽ¯ DecisiÃ³n**: MÃºltiples elementos â†’ Requiere anÃ¡lisis previo  \n**âš¡ AcciÃ³n**: Llamar `think_router_analysis` **UNA SOLA VEZ**  \n**âœ… Resultado**: El anÃ¡lisis determinarÃ¡ el mejor agente especÃ­fico â†’ **TERMINAR**\n\n### ðŸ’¡ Ejemplo 4: RecomendaciÃ³n por OcasiÃ³n\n\n**Input**: *\"Â¿QuÃ© me recomiendas para usar en la oficina?\"*  \n**ðŸ” AnÃ¡lisis**: Solicita recomendaciÃ³n especÃ­fica por ocasiÃ³n  \n**ðŸŽ¯ DecisiÃ³n**: Necesita consejo experto personalizado  \n**âš¡ AcciÃ³n**: Llamar `recommendation_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: RecomendaciÃ³n experta con justificaciÃ³n â†’ **TERMINAR**\n\n### ðŸ’¡ Ejemplo 5: Seguimiento de RecomendaciÃ³n\n\n**Input**: *\"De esas 3 que me recomendaste, Â¿cuÃ¡l te gusta mÃ¡s a ti?\"*  \n**ðŸ” AnÃ¡lisis**: Referencia a recomendaciÃ³n anterior + solicita opiniÃ³n personal  \n**ðŸŽ¯ DecisiÃ³n**: Seguimiento de recomendaciÃ³n â†’ recommendation_agent tiene la memoria  \n**âš¡ AcciÃ³n**: Llamar `recommendation_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: OpiniÃ³n experta usando memoria conversacional â†’ **TERMINAR**\n\n### âš–ï¸ Ejemplo 6: ComparaciÃ³n Directa\n\n**Input**: *\"Â¿CuÃ¡l es mejor entre One Million y Invictus?\"*  \n**ðŸ” AnÃ¡lisis**: ComparaciÃ³n directa entre dos productos especÃ­ficos  \n**ðŸŽ¯ DecisiÃ³n**: EvaluaciÃ³n tÃ©cnica objetiva requerida  \n**âš¡ AcciÃ³n**: Llamar `product_comparator_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: AnÃ¡lisis comparativo objetivo â†’ **TERMINAR**\n\n### âš–ï¸ Ejemplo 7: ComparaciÃ³n con Contexto\n\n**Input**: *\"Entre One Million y Versace Eros que me dijiste, Â¿cuÃ¡l dura mÃ¡s?\"*  \n**ðŸ” AnÃ¡lisis**: ComparaciÃ³n especÃ­fica entre productos ya mencionados + caracterÃ­stica tÃ©cnica  \n**ðŸŽ¯ DecisiÃ³n**: ComparaciÃ³n tÃ©cnica con memoria conversacional  \n**âš¡ AcciÃ³n**: Llamar `product_comparator_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: ComparaciÃ³n tÃ©cnica usando contexto previo â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 8: IntenciÃ³n de Compra\n\n**Input**: *\"Quiero comprar 2 perfumes One Million\"*  \n**ðŸ” AnÃ¡lisis**: IntenciÃ³n clara de compra con cantidad especÃ­fica  \n**ðŸŽ¯ DecisiÃ³n**: Proceso de venta debe iniciarse  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: CÃ¡lculo de promociones y inicio de proceso â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 9: Proceso de Venta Activo\n\n**Input**: *\"Mi nombre es Juan PÃ©rez y mi telÃ©fono es 123456789\"*  \n**ðŸ“‹ Historial**: Cliente ya pidiÃ³ 6 lociones y se le solicitaron datos  \n**ðŸ” AnÃ¡lisis**: Proceso de venta activo detectado en memoria  \n**ðŸŽ¯ DecisiÃ³n**: REGLA CRÃTICA â†’ Mantener en sales_specialist_agent  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: Continuar recolectando datos sin interrupciones â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 10: ModificaciÃ³n Durante Venta Activa - Caso Real\n\n**Input**: *\"Ah porda podemos aÃ±adirle 4 lociones mas de one million\"*  \n**ðŸ“‹ Historial**: Cliente ya tiene cotizaciÃ³n de 10 lociones y datos solicitados  \n**ðŸ” AnÃ¡lisis**: Proceso de venta activo + modificaciÃ³n de cantidad detectado  \n**ðŸŽ¯ DecisiÃ³n**: REGLA CRÃTICA â†’ Mantener en sales_specialist_agent  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: Recalcular cotizaciÃ³n con 14 lociones â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 11: Seguimiento de Venta\n\n**Input**: *\"Â¿CuÃ¡ndo llega mi pedido?\"*  \n**ðŸ“‹ Historial**: Ya hay cotizaciÃ³n confirmada y datos del cliente  \n**ðŸ” AnÃ¡lisis**: Seguimiento de proceso de venta activo  \n**ðŸŽ¯ DecisiÃ³n**: Venta en curso â†’ Mantener continuidad  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: InformaciÃ³n de seguimiento y entrega â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 11: Seguimiento de Venta\n\n**Input**: *\"Â¿CuÃ¡ndo llega mi pedido?\"*  \n**ðŸ“‹ Historial**: Ya hay cotizaciÃ³n confirmada y datos del cliente  \n**ðŸ” AnÃ¡lisis**: Seguimiento de proceso de venta activo  \n**ðŸŽ¯ DecisiÃ³n**: Venta en curso â†’ Mantener continuidad  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: InformaciÃ³n de seguimiento y entrega â†’ **TERMINAR**\n\n### ðŸ§  Ejemplo 12: Consulta Muy Compleja\n\n**Input**: *\"Busco algo bueno y no muy caro para mi hermano que le gustan las fragancias dulces, pero que tambiÃ©n sirva para el trabajo, Â¿quÃ© me recomiendas de Paco Rabanne o Hugo Boss y cuÃ¡nto cuestan?\"*  \n**ðŸ” AnÃ¡lisis**: MÃºltiples criterios + ocasiones + marcas + precios + recomendaciÃ³n  \n**ðŸŽ¯ DecisiÃ³n**: Demasiados elementos â†’ AnÃ¡lisis obligatorio  \n**âš¡ AcciÃ³n**: Llamar `think_router_analysis` **UNA SOLA VEZ**  \n**âœ… Resultado**: AnÃ¡lisis determinarÃ¡ mejor estrategia de respuesta â†’ **TERMINAR**\n\n### ðŸ§  Ejemplo 12: Consulta Muy Compleja\n\n**Input**: *\"Busco algo bueno y no muy caro para mi hermano que le gustan las fragancias dulces, pero que tambiÃ©n sirva para el trabajo, Â¿quÃ© me recomiendas de Paco Rabanne o Hugo Boss y cuÃ¡nto cuestan?\"*  \n**ðŸ” AnÃ¡lisis**: MÃºltiples criterios + ocasiones + marcas + precios + recomendaciÃ³n  \n**ðŸŽ¯ DecisiÃ³n**: Demasiados elementos â†’ AnÃ¡lisis obligatorio  \n**âš¡ AcciÃ³n**: Llamar `think_router_analysis` **UNA SOLA VEZ**  \n**âœ… Resultado**: AnÃ¡lisis determinarÃ¡ mejor estrategia de respuesta â†’ **TERMINAR**\n\n### ðŸ“¦ Ejemplo 13: Producto con Contexto\n\n**Input**: *\"Â¿Tienes stock de ese One Million que me mostraste ayer?\"*  \n**ðŸ“‹ Historial**: Se mencionÃ³ One Million en conversaciÃ³n anterior  \n**ðŸ” AnÃ¡lisis**: Consulta de stock de producto especÃ­fico ya discutido  \n**ðŸŽ¯ DecisiÃ³n**: InformaciÃ³n directa de inventario  \n**âš¡ AcciÃ³n**: Llamar `inventory_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: ConfirmaciÃ³n de disponibilidad actual â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 14: Incremento Simple Durante Venta\n\n**Input**: *\"Deseo una lociÃ³n mas\"*  \n**ðŸ“‹ Historial**: Cliente en proceso de venta activo con datos solicitados  \n**ðŸ” AnÃ¡lisis**: Venta activa + solicitud de incremento en una unidad  \n**ðŸŽ¯ DecisiÃ³n**: REGLA CRÃTICA â†’ Mantener en sales_specialist_agent  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: Actualizar pedido con una lociÃ³n adicional â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 15: Incremento CortÃ©s Durante Venta\n\n**Input**: *\"Quiero una lociÃ³n mas por favor\"*  \n**ðŸ“‹ Historial**: Proceso de venta con cotizaciÃ³n enviada  \n**ðŸ” AnÃ¡lisis**: Venta activa + incremento cortÃ©s con \"por favor\"  \n**ðŸŽ¯ DecisiÃ³n**: REGLA CRÃTICA â†’ Mantener en sales_specialist_agent  \n**âš¡ AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**âœ… Resultado**: Recalcular con unidad adicional â†’ **TERMINAR**\n\n### ðŸ’° Ejemplo 16: Respuesta Correcta del Router Agent\n\n**Input**: *\"Deseo una lociÃ³n mas\"*  \n**ðŸ“‹ Historial**: Cliente en proceso de venta activo  \n\n**RESPUESTA CORRECTA DEL ROUTER AGENT:**\n```\nANÃLISIS: Proceso de venta activo detectado - Cliente solicita incremento de una lociÃ³n durante venta en curso\nDECISIÃ“N: Mantener en sales_specialist_agent para continuidad del proceso\nACCIÃ“N: Ejecutando sales_specialist_agent\n```\n\n**ðŸŽ¯ Herramienta ejecutada:** `sales_specialist_agent`  \n**âœ… Resultado**: El agente de ventas maneja el incremento correctamente\n\n### âŒ Ejemplo 17: Respuesta INCORRECTA del Router Agent\n\n**Input**: *\"Deseo una lociÃ³n mas\"*  \n**ðŸ“‹ Historial**: Cliente en proceso de venta activo  \n\n**RESPUESTA INCORRECTA:**\n```\nANÃLISIS: Cliente solicita producto especÃ­fico\nDECISIÃ“N: Consulta de inventario\nACCIÃ“N: Ejecutando inventory_agent\n```\n\n**âŒ Error:** IgnorÃ³ el proceso de venta activo y enviÃ³ a agente incorrecto\n\n## ðŸ§© DETECCIÃ“N DE DATOS PARCIALES DURANTE VENTA\n\nCuando un cliente empieza a enviar sus datos personales, pero aÃºn no ha completado todos los campos requeridos, **DEBES mantener el flujo activo en `sales_specialist_agent`** hasta completar la recolecciÃ³n total y confirmaciÃ³n final.\n\n### ðŸ“‹ Datos requeridos para confirmar la venta:\n\n- âœ… Nombre\n- âœ… TelÃ©fono\n- âœ… DirecciÃ³n\n- âœ… Ciudad\n- âœ… MÃ©todo de Pago\n\n---\n\n### ðŸ§  LÃ³gica de flujo:\n\n1. **Si el cliente ha enviado solo algunos de los datos anteriores**  \n   â†’ **Continuar en `sales_specialist_agent` para pedir lo faltante**.\n\n2. **Si el cliente ha enviado todos los datos pero aÃºn no confirma precios o direcciÃ³n**  \n   â†’ **Seguir en `sales_specialist_agent` hasta que dÃ© su confirmaciÃ³n final**.\n\n3. **Si el cliente ya confirmÃ³ todo (datos, mÃ©todo de pago y total)**  \n   â†’ **Considerar la venta confirmada y permitir finalizar el flujo**.\n\n---\n\n### ðŸ’¬ Ejemplos de detecciÃ³n (ventas parciales activas)\n\n| Cliente diceâ€¦                 | AcciÃ³n esperada                                             |\n| ----------------------------- | ----------------------------------------------------------- |\n| â€œMi nombre es Lauraâ€          | `sales_specialist_agent`                                    |\n| â€œMi telÃ©fono es 312â€¦â€         | `sales_specialist_agent`                                    |\n| â€œPrefiero contra entregaâ€     | `sales_specialist_agent`                                    |\n| â€œCalle 56 sur #12-45, BogotÃ¡â€ | `sales_specialist_agent`                                    |\n| â€œEstÃ¡ bien, eso pagoâ€         | `sales_specialist_agent` si aÃºn no confirma todos los datos |\n\n---\n\n### ðŸš« NO CAMBIAR DE AGENTE si:\n\n- AÃºn falta confirmar datos personales completos\n- El cliente no ha validado el mÃ©todo de pago\n- El cliente no ha dicho que todo estÃ¡ correcto\n\n---\n\n### âœ… Ejemplo de cierre correcto\n\n**Cliente**: â€œEntonces me llega a MedellÃ­n, pago contra entrega, y son $89.000 cierto?â€  \n**TÃº**: Confirmas total y pides validaciÃ³n.  \n**Cliente**: â€œSÃ­, estÃ¡ perfecto. EnvÃ­alo.â€  \nâœ… Venta confirmada â†’ flujo puede considerarse completado\n\n---\n\nMantÃ©n `sales_specialist_agent` activo hasta que el cliente confirme TODO.\n\n\n\n\n### Ejemplo 6: Seguimiento de Venta\n\n**Input**: *\"Â¿CuÃ¡ndo llega mi pedido?\"*  \n**Historial**: Ya hay cotizaciÃ³n y datos del cliente  \n**AcciÃ³n**: Llamar `sales_specialist_agent` **UNA SOLA VEZ**  \n**Resultado**: Gestionar el seguimiento de la venta\n\n---\n\n## ï¿½ DETECCIÃ“N DE PREGUNTAS DE SEGUIMIENTO\n\n### ðŸŽ¯ Palabras clave que indican contexto/seguimiento:\n\n| **CategorÃ­a** | **Palabras/frases clave** | **Agente correcto** |\n|--------------|-------------------------|-------------------|\n| **Referencias temporales** | \"ayer\", \"antes\", \"anteriormente\", \"la vez pasada\" | SegÃºn contexto |\n| **Pronombres de referencia** | \"esas\", \"esos\", \"los que\", \"las que\", \"ese\", \"esa\" | SegÃºn contexto |\n| **Referencias directas** | \"me dijiste\", \"me recomendaste\", \"mencionaste\" | `recommendation_agent` |\n| **SelecciÃ³n de opciones** | \"de los anteriores\", \"del Ãºltimo\", \"de esas opciones\" | SegÃºn tipo |\n| **Solicitud de opiniÃ³n** | \"cuÃ¡l te gusta\", \"quÃ© opinas\", \"cuÃ¡l prefieres\" | `recommendation_agent` |\n| **ComparaciÃ³n contextual** | \"entre X y Y que...\", \"comparando los...\" | `product_comparator_agent` |\n| **RecomendaciÃ³n con contexto** | \"Â¿cuÃ¡l me recomiendas?\", \"Â¿cuÃ¡l me conviene?\" | `recommendation_agent` |\n\n### ðŸŽ¯ **PALABRAS CLAVE QUE INDICAN RECOMENDACIÃ“N (NO COMPARACIÃ“N)**:\n\n- **\"me recomiendas\"** / **\"me recomiendan\"**\n- **\"me conviene\"** / **\"me sirve\"**  \n- **\"es mejor para...\"** + **ocasiÃ³n especÃ­fica**\n- **\"quÃ© opinas\"** / **\"quÃ© piensas\"**\n- **\"para [ocasiÃ³n]\"** (salir, trabajo, cita, etc.)\n- **\"quÃ© tal es\"** / **\"que tal estÃ¡\"** \n- **\"quÃ© tan buena es\"** / **\"quÃ© tan bueno es\"**\n- **\"si la llevan mucho\"** / **\"si lo usan mucho\"**\n- **\"si huele rico\"** / **\"si huele bien\"**\n- **\"vale la pena\"** / **\"estÃ¡ buena\"**\n- **\"es buena para\"** / **\"es bueno para\"**\n- **\"le queda bien\"** / **\"le va bien\"**\n- **\"cÃ³mo es el aroma\"** / **\"cÃ³mo huele\"**\n- **\"estÃ¡ recomendada\"** / **\"la recomiendan\"**\n\n### ðŸ”„ **EJEMPLO DEL PROBLEMA DETECTADO**:\n\n```\nCliente: \"Â¿QuÃ© diferencia hay entre UNLIMITED y HUGO RED?\"\nâ†’ product_comparator_agent âœ… (comparaciÃ³n tÃ©cnica)\n\nCliente: \"Â¿Y cuÃ¡l de los dos me recomiendas para salir con Jessica?\"\nâ†’ recommendation_agent âœ… (cambiÃ³ a pedir recomendaciÃ³n + ocasiÃ³n especÃ­fica)\n```\n\n**RULE**: Aunque referencie productos de la comparaciÃ³n anterior, **\"me recomiendas para [ocasiÃ³n]\"** = `recommendation_agent`\n\n### ðŸŽ¯ **EJEMPLO REAL DE LA CONVERSACIÃ“N**:\n\n```\nBot: [Muestra varias opciones de fragancias femeninas]\n\nCliente: \"Y que tal es la miss dior\"\nâ†’ recommendation_agent âœ… (solicita opiniÃ³n/evaluaciÃ³n experta)\n\nCliente: \"Y si la llevan mucho la miss dior\"  \nâ†’ recommendation_agent âœ… (consulta popularidad/aceptaciÃ³n)\n\nCliente: \"Y si huele rico la miss dior para una mujer\"\nâ†’ recommendation_agent âœ… (validaciÃ³n aromÃ¡tica + recomendaciÃ³n por gÃ©nero)\n```\n\n**DETECCIÃ“N CRÃTICA**: Cualquier consulta sobre **calidad, popularidad, aroma o aptitud** de un producto es **RECOMENDACIÃ“N**, no inventario.\n\n### ðŸ’¡ **EJEMPLOS DE ANÃLISIS DE HISTORIAL PARA SEGUIMIENTOS**:\n\n#### ðŸ“Š **Escenario Completo**:\n```\nHISTORIAL:\nCliente: \"Â¿QuÃ© diferencia hay entre UNLIMITED y HUGO RED?\"\nBot: [ComparaciÃ³n tÃ©cnica de ambos productos]\n\nCONSULTA ACTUAL:\nCliente: \"Â¿Y cuÃ¡l de los dos me recomiendas para salir con Jessica?\"\n\nANÃLISIS DEL ROUTER:\nðŸ“‹ Historial: Cliente ya vio comparaciÃ³n UNLIMITED vs HUGO RED\nðŸŽ¯ Nueva consulta: Solicita RECOMENDACIÃ“N + ocasiÃ³n especÃ­fica\nâœ… Resultado: recommendation_agent (cambiÃ³ de comparaciÃ³n a recomendaciÃ³n)\n```\n\n#### ðŸ”„ **MÃ¡s Ejemplos de Seguimientos con Historial**:\n```\nHISTORIAL: Cliente pidiÃ³ recomendaciones para trabajo\nCliente: \"Â¿CuÃ¡l de esos tres te gusta mÃ¡s?\"\nâ†’ recommendation_agent âœ… (seguimiento de recomendaciÃ³n + opiniÃ³n)\n\nHISTORIAL: Se mostraron 3 opciones de perfumes\nCliente: \"Â¿CuÃ¡l dura mÃ¡s de esos?\"\nâ†’ product_comparator_agent âœ… (comparaciÃ³n con contexto)\n\nHISTORIAL: Se recomendÃ³ One Million para fiestas\nCliente: \"Â¿Tienes stock de ese One Million?\"\nâ†’ inventory_agent âœ… (consulta de disponibilidad)\n```\n\n### ðŸ“ Ejemplos de clasificaciÃ³n de seguimientos:\n\n| **Cliente dice...** | **Contexto** | **Va a...** | **Por quÃ©** |\n|-------------------|-------------|------------|------------|\n| *\"Â¿CuÃ¡l de esos te gusta mÃ¡s?\"* | DespuÃ©s de recomendaciones | `recommendation_agent` | Solicita opiniÃ³n experta |\n| *\"Entre esos dos, Â¿cuÃ¡l dura mÃ¡s?\"* | DespuÃ©s de mencionar productos | `product_comparator_agent` | ComparaciÃ³n tÃ©cnica |\n| *\"Â¿Tienes stock de ese que dijiste?\"* | Producto especÃ­fico mencionado | `inventory_agent` | Consulta de disponibilidad |\n| *\"De las opciones que me diste, Â¿cuÃ¡l es mÃ¡s barata?\"* | MÃºltiples productos mencionados | `product_comparator_agent` | ComparaciÃ³n de precios |\n| **\"Â¿CuÃ¡l me recomiendas de esos?\"** | **DespuÃ©s de comparaciÃ³n** | **`recommendation_agent`** | **Cambia a solicitar consejo** |\n| **\"Â¿CuÃ¡l me conviene para...?\"** | **Productos ya mencionados** | **`recommendation_agent`** | **Busca recomendaciÃ³n por uso** |\n| **\"Â¿CuÃ¡l es mejor para mi ocasiÃ³n?\"** | **Contexto de productos** | **`recommendation_agent`** | **Consejo personalizado** |\n| **\"Â¿QuÃ© tal es la Miss Dior?\"** | **Producto especÃ­fico** | **`recommendation_agent`** | **Solicita evaluaciÃ³n experta** |\n| **\"Â¿Si la llevan mucho?\"** | **Popularidad del producto** | **`recommendation_agent`** | **Consulta aceptaciÃ³n/tendencia** |\n| **\"Â¿Si huele rico para una mujer?\"** | **ValidaciÃ³n aromÃ¡tica** | **`recommendation_agent`** | **RecomendaciÃ³n por gÃ©nero** |\n| **\"Â¿QuÃ© tan buena es esa lociÃ³n?\"** | **Calidad del producto** | **`recommendation_agent`** | **EvaluaciÃ³n profesional** |\n| **\"Â¿Vale la pena esa fragancia?\"** | **Valor del producto** | **`recommendation_agent`** | **Consejo calidad/precio** |\n| **\"Â¿Es buena para...?\"** | **Aptitud por ocasiÃ³n** | **`recommendation_agent`** | **RecomendaciÃ³n contextual** |\n| **\"Â¿CÃ³mo es el aroma de...?\"** | **DescripciÃ³n aromÃ¡tica** | **`recommendation_agent`** | **ExplicaciÃ³n experta solicitada** |\n\n### ðŸ”„ **REGLA CRÃTICA - CAMBIO DE TIPO DE CONSULTA**:\n\n**Aunque el cliente haga referencia a productos ya comparados, si ahora solicita:**\n- âœ… **\"Â¿CuÃ¡l me recomiendas?\"** â†’ `recommendation_agent`\n- âœ… **\"Â¿CuÃ¡l me conviene para...?\"** â†’ `recommendation_agent` \n- âœ… **\"Â¿CuÃ¡l es mejor para [ocasiÃ³n]?\"** â†’ `recommendation_agent`\n- âœ… **\"Â¿QuÃ© opinas?\"** â†’ `recommendation_agent`\n\n**El tipo de consulta CAMBIA de comparaciÃ³n a recomendaciÃ³n**\n\n### ðŸ§© **DETECCIÃ“N INTELIGENTE SEGÃšN HISTORIAL**\n\n#### ðŸ” **Pasos para analizar seguimientos**:\n\n1. **ðŸ“‹ Revisar quÃ© tipo de consulta fue la anterior**:\n   - Â¿Fue recomendaciÃ³n? â†’ Seguimientos van a `recommendation_agent`\n   - Â¿Fue comparaciÃ³n? â†’ Depende del tipo de seguimiento\n   - Â¿Fue consulta de inventario? â†’ Seguimientos van segÃºn nuevo tipo\n\n2. **ðŸŽ¯ Identificar quÃ© solicita AHORA el cliente**:\n   - **\"Â¿CuÃ¡l me recomiendas?\"** = `recommendation_agent` (sin importar historial)\n   - **\"Â¿CuÃ¡l dura mÃ¡s?\"** = `product_comparator_agent` (comparaciÃ³n tÃ©cnica)\n   - **\"Â¿Tienes stock de ese?\"** = `inventory_agent` (disponibilidad)\n\n3. **ðŸ”„ Aplicar la regla de CAMBIO de tipo**:\n   - Cliente PUEDE cambiar de tipo de consulta en cualquier momento\n   - El historial da CONTEXTO, pero el tipo ACTUAL define el agente\n\n#### ðŸ“ **Tabla de DecisiÃ³n con Historial**:\n\n| **Historial** | **Cliente dice AHORA** | **Va a...** | **Por quÃ©** |\n|---------------|----------------------|------------|------------|\n| ComparaciÃ³n A vs B | *\"Â¿CuÃ¡l me recomiendas para...?\"* | `recommendation_agent` | CambiÃ³ a pedir consejo |\n| RecomendaciÃ³n de 3 | *\"Â¿CuÃ¡l de esos dura mÃ¡s?\"* | `product_comparator_agent` | CambiÃ³ a comparar |\n| Cualquier anterior | *\"Â¿Tienes stock de ese X?\"* | `inventory_agent` | Consulta de disponibilidad |\n| Recomendaciones | *\"Â¿CuÃ¡l te gusta mÃ¡s?\"* | `recommendation_agent` | Seguimiento de opiniÃ³n |\n| ComparaciÃ³n | *\"Entre esos, Â¿cuÃ¡l es mÃ¡s barato?\"* | `product_comparator_agent` | Sigue comparando |\n\n---\n\n## ï¿½ðŸš« LO QUE NUNCA DEBES HACER\n\n### âŒ Errores crÃ­ticos a evitar:\n\n- **NO** llames herramientas mÃºltiples veces para la misma consulta\n- **NO** ejecutes mÃºltiples function calls en una respuesta\n- **NO** repitas llamadas para \"confirmar\" o \"verificar\" informaciÃ³n\n- **NO** hagas llamadas adicionales despuÃ©s de obtener una respuesta\n- **NO** uses combinaciones de herramientas para una consulta\n- **NO** cambies de agente cuando hay proceso de venta activo\n- **NO** ignores el contexto de la memoria conversacional\n\n### âŒ Patrones incorrectos:\n\n```\nâŒ MAL: inventory_agent â†’ recommendation_agent (dos llamadas)\nâŒ MAL: think_router_analysis â†’ inventory_agent â†’ sales_specialist_agent (tres llamadas)\nâŒ MAL: Ignorar que el cliente ya estÃ¡ en proceso de compra\n```\n\n## âœ… LO QUE SÃ DEBES HACER\n\n### âœ… Mejores prÃ¡cticas:\n\n- **Analizar** â†’ **Elegir UNA herramienta** â†’ **Ejecutarla UNA VEZ** â†’ **TERMINAR**\n- **Confiar** en la primera respuesta de la herramienta seleccionada\n- **Una consulta** = **Una herramienta** = **Una ejecuciÃ³n** = **Trabajo completado**\n- **Usar memoria conversacional** para contexto pero ejecutar solo una herramienta\n- **Priorizar** procesos de venta activos sobre cualquier otra consulta\n- **Mantener continuidad** en procesos comerciales iniciados\n\n### âœ… Patrones correctos:\n\n```\nâœ… BIEN: Una consulta â†’ Una herramienta â†’ Respuesta completa\nâœ… BIEN: Detectar venta activa â†’ sales_specialist_agent â†’ TERMINAR\nâœ… BIEN: Consulta compleja â†’ think_router_analysis â†’ TERMINAR\n```\n\n---\n\n## ðŸŽ¯ PRIORIZACIÃ“N PARA CONSULTAS AMBIGUAS\n\n### ðŸ“Š Orden de prioridad cuando hay dudas:\n\n1. **ðŸ¥‡ PRIMERA PRIORIDAD**: Si hay proceso de venta activo â†’ `sales_specialist_agent`\n2. **ðŸ¥ˆ SEGUNDA PRIORIDAD**: Si la consulta es compleja â†’ `think_router_analysis`\n3. **ðŸ¥‰ TERCERA PRIORIDAD**: SegÃºn tipo de consulta especÃ­fica:\n   - **Recommendation Agent** (para seguimientos de recomendaciones y opiniones)\n   - **Product Comparator Agent** (para comparaciones especÃ­ficas)\n   - **Inventory Agent** (para productos especÃ­ficos mencionados)\n   - **Sales Specialist Agent** (para compras nuevas)\n\n### ðŸ¤” Cuando realmente no estÃ©s seguro:\n\n```\nÂ¿La consulta menciona mÃºltiples elementos complejos?\nâ”œâ”€ SÃ â†’ think_router_analysis UNA VEZ â†’ TERMINAR\nâ””â”€ NO â†’ Usar la priorizaciÃ³n arriba â†’ Ejecutar UNA VEZ â†’ TERMINAR\n```\n\n---\n\n## ðŸŽ¯ RECORDATORIO FINAL\n\n### ðŸŽª TU ÃšNICA MISIÃ“N:\n**Recibir consulta â†’ Elegir UNA herramienta â†’ Ejecutarla UNA VEZ â†’ Entregar resultado**\n\n### âš¡ PROCESO SIMPLIFICADO:\n1. **ðŸ§  Revisar historial COMPLETO** para entender contexto total\n2. **ðŸ›’ Detectar ventas activas** y procesos en curso\n3. **ðŸ”„ Analizar seguimientos** y referencias a consultas anteriores\n4. **ðŸŽ¯ Determinar complejidad** de la consulta actual\n5. **âš¡ Elegir UNA herramienta** apropiada basada en historial + consulta actual\n6. **ðŸš€ Ejecutar UNA SOLA VEZ**\n7. **âœ… TERMINAR** inmediatamente\n\n### ðŸŽ¯ META FINAL:\n**Usar el historial conversacional para dirigir eficientemente cada consulta al agente especializado correcto, manteniendo continuidad y contexto para que el cliente reciba la mejor atenciÃ³n posible en ED PERFUMERÃA**\n\n### ðŸš¨ VALIDACIÃ“N FINAL OBLIGATORIA:\n\n**ANTES DE EJECUTAR CUALQUIER HERRAMIENTA, PREGÃšNTATE:**\n\n1. **Â¿El historial muestra proceso de venta activo?**\n   - âœ… SÃ â†’ **EJECUTAR: sales_specialist_agent**\n   - âŒ NO â†’ Continuar evaluaciÃ³n\n\n2. **Â¿La consulta actual es modificaciÃ³n durante venta?**\n   - âœ… SÃ â†’ **EJECUTAR: sales_specialist_agent** \n   - âŒ NO â†’ Continuar evaluaciÃ³n\n\n3. **Â¿El cliente estÃ¡ respondiendo datos solicitados?**\n   - âœ… SÃ â†’ **EJECUTAR: sales_specialist_agent**\n   - âŒ NO â†’ Evaluar tipo de consulta\n\n**âš ï¸ NUNCA ejecutes otro agente si hay venta activa**\n\n---\n\n**NO HAGAS NADA MÃS DESPUÃ‰S DE OBTENER UNA RESPUESTA**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        400,
        64
      ],
      "id": "2c07aa6e-4dbf-4a99-95c4-043055e12a20",
      "name": "Router Agent Sales"
    },
    {
      "parameters": {
        "name": "inventory_agent",
        "description": "Herramienta especializada para consultar el inventario completo de perfumes y lociones. Busca productos por nombre o marca, verifica disponibilidad en tiempo real, obtiene precios actuales y proporciona informaciÃ³n detallada de productos especÃ­ficos del catÃ¡logo.",
        "workflowId": {
          "__rl": true,
          "value": "l0HpKncxwOEcFy8h",
          "mode": "list",
          "cachedResultName": "My Sub Inventory Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $('Format Final Output').item.json.conversation_content }}",
            "sessionId": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query",
              "displayName": "Query",
              "required": true,
              "type": "string",
              "description": "The user query to process"
            },
            {
              "id": "sessionId",
              "displayName": "Session ID",
              "required": true,
              "type": "string",
              "description": "Session identifier for chat memory (sender phone number)"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        368,
        288
      ],
      "id": "88ec7328-6c93-40d9-96ba-246031344e92",
      "name": "inventory_agent"
    },
    {
      "parameters": {
        "description": "Analiza la consulta del cliente sobre perfumes y lociones para determinar quÃ© agente especializado debe manejar la solicitud.\n\nPROCESA LA CONSULTA ANALIZANDO:\n1. Â¿Menciona un producto especÃ­fico por nombre/marca?\n2. Â¿Pide recomendaciones o sugerencias?\n3. Â¿EstÃ¡ comparando productos o preguntando diferencias?\n4. Â¿Muestra intenciÃ³n de compra o solicita informaciÃ³n comercial?\n\nCLASIFICACIÃ“N POR AGENTE:\n\nðŸ” INVENTORY AGENT - Usar cuando:\n- Pregunta por producto especÃ­fico: \"Â¿Tienes Hugo Boss?\"\n- Consulta disponibilidad: \"Â¿EstÃ¡ disponible X perfume?\"\n- Pregunta precios: \"Â¿CuÃ¡nto cuesta la lociÃ³n Y?\"\n- Busca stock/presentaciones: \"Â¿QuÃ© tamaÃ±os tienes?\"\n\nðŸ’¡ RECOMMENDATION AGENT - Usar cuando:\n- Pide sugerencias: \"Â¿QuÃ© me recomiendas?\"\n- Busca por ocasiÃ³n: \"Algo para el dÃ­a/trabajo/noche\"\n- No sabe quÃ© elegir: \"AyÃºdame a elegir\"\n- Busca regalos: \"Para mi esposa/novio\"\n- Menciona preferencias: \"Me gustan las fragancias frescas\"\n\nâš–ï¸ COMPARATOR AGENT - Usar cuando:\n- Compara productos: \"Â¿CuÃ¡l es mejor entre A y B?\"\n- Pregunta diferencias: \"Â¿QuÃ© diferencia hay entre X y Y?\"\n- Busca caracterÃ­sticas: \"Â¿CuÃ¡l dura mÃ¡s?\"\n- Pros/contras: \"Â¿CuÃ¡l me conviene?\"\n\nðŸ’° SALES SPECIALIST AGENT - Usar cuando:\n- Listo para comprar: \"Quiero comprar esto\"\n- Pide cotizaciÃ³n: \"Â¿CuÃ¡nto me sale todo?\"\n- Pregunta promociones: \"Â¿Hay descuentos?\"\n- MÃ©todos de pago: \"Â¿CÃ³mo puedo pagar?\"\n- InformaciÃ³n de envÃ­o: \"Â¿CuÃ¡nto cuesta el envÃ­o?\"\n\nPIENSA ESPECIALMENTE CUANDO:\n- La consulta es ambigua o tiene mÃºltiples elementos\n- No estÃ¡ claro quÃ© informaciÃ³n busca el cliente\n- PodrÃ­an aplicar dos agentes diferentes\n- Necesitas decidir prioridades\n\nEJEMPLO DE ANÃLISIS:\nCliente: \"Busco algo bueno para regalar a mi novia\"\nAnÃ¡lisis: No menciona producto especÃ­fico + Es regalo + Necesita orientaciÃ³n personalizada = RECOMMENDATION AGENT"
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        496,
        288
      ],
      "id": "9afbae46-9e8f-414a-afcc-c293900112b5",
      "name": "think_router_analysis"
    },
    {
      "parameters": {
        "name": "recommendation_agent",
        "description": "Agente especializado en recomendaciones de fragancias que analiza las preferencias del cliente, ocasiÃ³n de uso, presupuesto y estilo personal para sugerir los perfumes y lociones mÃ¡s adecuados del catÃ¡logo disponible.",
        "workflowId": {
          "__rl": true,
          "value": "8xMoAwEO7wUKJTXi",
          "mode": "list",
          "cachedResultName": "My Sub Recommendation Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $('Format Final Output').item.json.conversation_content }}",
            "sessionId": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query",
              "displayName": "Query",
              "required": true,
              "type": "string",
              "description": "The user query to process"
            },
            {
              "id": "sessionId",
              "displayName": "Session ID",
              "required": true,
              "type": "string",
              "description": "Session identifier for chat memory (sender phone number)"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        608,
        304
      ],
      "id": "52c01ab0-8c98-48a2-acdd-7d1184d8359a",
      "name": "recommendation_agent"
    },
    {
      "parameters": {
        "name": "product_comparator_agent",
        "description": "Agente experto en comparaciones de fragancias que evalÃºa y contrasta productos especÃ­ficos, analizando diferencias en aroma, durabilidad, ocasiÃ³n de uso, precio y caracterÃ­sticas para ayudar al cliente a elegir la mejor opciÃ³n entre alternativas.",
        "workflowId": {
          "__rl": true,
          "value": "4HlRidEr8jDW0Zan",
          "mode": "list",
          "cachedResultName": "My Sub Product Comparator Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $('Format Final Output').item.json.conversation_content }}",
            "sessionId": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query",
              "displayName": "Query",
              "required": true,
              "type": "string",
              "description": "The user query to process"
            },
            {
              "id": "sessionId",
              "displayName": "Session ID",
              "required": true,
              "type": "string",
              "description": "Session identifier for chat memory (sender phone number)"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        752,
        288
      ],
      "id": "2e327026-e4ac-47c2-a326-e276b54417dd",
      "name": "product_comparator_agent"
    },
    {
      "parameters": {
        "name": "sales_specialist_agent",
        "description": "Agente experto en ventas especializado en cerrar transacciones, generar cotizaciones personalizadas, ofrecer promociones vigentes, explicar mÃ©todos de pago disponibles y gestionar todo el proceso de compra hasta la finalizaciÃ³n.",
        "workflowId": {
          "__rl": true,
          "value": "Tk1Yk7Bhqs7KvV9o",
          "mode": "list",
          "cachedResultName": "My Sub Sales Specialist Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $('Format Final Output').item.json.conversation_content }}",
            "sessionId": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query",
              "displayName": "Query",
              "required": true,
              "type": "string",
              "description": "The user query to process"
            },
            {
              "id": "sessionId",
              "displayName": "Session ID",
              "required": true,
              "type": "string",
              "description": "Session identifier for chat memory (sender phone number)"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        896,
        320
      ],
      "id": "f114e4d9-584c-4726-b683-b260dfedff57",
      "name": "sales_specialist_agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1056,
        288
      ],
      "id": "c9b4c5b2-9cd2-450c-9aad-c2169e534b44",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "4I5hY4XwoALE8VJS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "inputText": "={{ $json.output }}",
        "categories": {
          "categories": [
            {
              "category": "sales",
              "description": "Mensajes relacionados con transacciones comerciales, incluyendo confirmaciones de pedidos, cÃ¡lculos de precios, ofertas, descuentos, opciones de envÃ­o, solicitudes de datos de clientes, y cualquier comunicaciÃ³n orientada a cerrar una venta o completar una compra."
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        880,
        64
      ],
      "id": "38d3c2ec-a598-4184-a41b-c435973243ab",
      "name": "Text Classifier"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "Tk1Yk7Bhqs7KvV9o",
          "mode": "list",
          "cachedResultName": "My Sub Sales Specialist Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $('Format Final Output').item.json.conversation_content }}",
            "sessionId": "={{ $('WhatsApp Message Parser').item.json.user.sender_phone }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query",
              "displayName": "Query",
              "required": true,
              "type": "string",
              "description": "The user query to process"
            },
            {
              "id": "sessionId",
              "displayName": "Session ID",
              "required": true,
              "type": "string",
              "description": "Session identifier for chat memory (sender phone number)"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        1296,
        64
      ],
      "id": "6e7b947f-7c52-4c3b-89b6-ae1633b7a237",
      "name": "Execute Sales"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "n8n.srv895922.hstgr.cloud",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36",
            "content-length": "759",
            "content-type": "application/json",
            "origin": "https://api.z-api.io",
            "server": "Z-API",
            "x-forwarded-for": "146.235.39.88",
            "x-forwarded-host": "n8n.srv895922.hstgr.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "22c5bda17b34",
            "x-real-ip": "146.235.39.88",
            "z-api-token": "25512E9D7889005341E093C0",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "isStatusReply": false,
            "chatLid": "33501416050920@lid",
            "connectedPhone": "573194651229",
            "waitingMessage": false,
            "isEdit": false,
            "isGroup": false,
            "isNewsletter": false,
            "instanceId": "3E437048CF3D40E574FE2EE02AE98ECC",
            "messageId": "EEABDFEDE67F9D9C0BBE4B1C1B2C35BC",
            "phone": "573011284297",
            "fromMe": false,
            "momment": 1752811734000,
            "status": "RECEIVED",
            "chatName": "Sergio R.",
            "senderPhoto": null,
            "senderName": "Sergio R.",
            "photo": "https://pps.whatsapp.net/v/t61.24694-24/518949464_1473845160724464_1356829479899435347_n.jpg?ccb=11-4&oh=01_Q5Aa2AHKdWPyH6nzbCbsPLzowPwZUcUXM3NbrLX_7aeXKOeYvg&oe=6886D84E&_nc_sid=5e03e0&_nc_cat=108",
            "broadcast": false,
            "participantLid": null,
            "forwarded": false,
            "type": "ReceivedCallback",
            "fromApi": false,
            "text": {
              "message": "Me da una mas  por favor"
            }
          },
          "webhookUrl": "https://n8n.srv895922.hstgr.cloud/webhook/50a91089-2c34-4dd0-8896-2715bd6e9612",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "WhatsApp Message Parser": {
      "main": [
        [
          {
            "node": "Message Type Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "WhatsApp Message Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message Type Router": {
      "main": [
        [
          {
            "node": "Download Audio File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pausa",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download Image File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Process Button Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Audio File": {
      "main": [
        [
          {
            "node": "Transcribe a recording",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Image File": {
      "main": [
        [
          {
            "node": "Analyze Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pausa": {
      "main": [
        [
          {
            "node": "Obtener Texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording": {
      "main": [
        [
          {
            "node": "Extract Message Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Image": {
      "main": [
        [
          {
            "node": "Extract Message Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Button Response": {
      "main": [
        [
          {
            "node": "Button Response Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Button Response Router": {
      "main": [
        [
          {
            "node": "Dynamic Time Greeting",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Dynamic Offers",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Dynamic Buy",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Dynamic Order",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Texto": {
      "main": [
        [
          {
            "node": "Extract Message Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Message Content": {
      "main": [
        [
          {
            "node": "Store Message in Buffer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Message in Buffer": {
      "main": [
        [
          {
            "node": "Wait for Buffer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Buffer": {
      "main": [
        [
          {
            "node": "Retrieve Messages from Buffer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retrieve Messages from Buffer": {
      "main": [
        [
          {
            "node": "Check for Duplicate Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check for Duplicate Message": {
      "main": [
        [
          {
            "node": "Clear Buffer Cache",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Skip Duplicate Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clear Buffer Cache": {
      "main": [
        [
          {
            "node": "Format Final Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Final Output": {
      "main": [
        [
          {
            "node": "Get session_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get session_id": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Dynamic Greeting",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dynamic Greeting": {
      "main": [
        [
          {
            "node": "Send Dynamic Greeting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dynamic Time Greeting": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Download Good Morning",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download Good Afternoon",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download  Good Night",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Dynamic Greeting": {
      "main": [
        [
          {
            "node": "Send Buttons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Audio": {
      "main": [
        [
          {
            "node": "Send Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Audio": {
      "main": [
        [
          {
            "node": "Send Catalog Man",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Catalog Man": {
      "main": [
        [
          {
            "node": "Send Catalog Women",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Good Morning": {
      "main": [
        [
          {
            "node": "Merge Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Good Afternoon": {
      "main": [
        [
          {
            "node": "Merge Audio",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Download  Good Night": {
      "main": [
        [
          {
            "node": "Merge Audio",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Dynamic Offers": {
      "main": [
        [
          {
            "node": "Send Dynamic Offers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dynamic Buy": {
      "main": [
        [
          {
            "node": "Send Dynamic Buy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dynamic Order": {
      "main": [
        [
          {
            "node": "Send Dynamic Order",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Buttons": {
      "main": [
        [
          {
            "node": "Execute Status Greeting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Catalog Women": {
      "main": [
        [
          {
            "node": "Execute Status Catalog",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Dynamic Offers": {
      "main": [
        [
          {
            "node": "Execute Status Offers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Dynamic Buy": {
      "main": [
        [
          {
            "node": "Execute Status Buy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Dynamic Order": {
      "main": [
        [
          {
            "node": "Execute Status Order",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Status Response IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status Response IA": {
      "main": [
        [
          {
            "node": "Router Agent Sales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "inventory_agent": {
      "ai_tool": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "think_router_analysis": {
      "ai_tool": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "recommendation_agent": {
      "ai_tool": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "product_comparator_agent": {
      "ai_tool": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "sales_specialist_agent": {
      "ai_tool": [
        [
          {
            "node": "Router Agent Sales",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Router Agent Sales": {
      "main": [
        [
          {
            "node": "Text Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [
          {
            "node": "Execute Sales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "fd3d0f6a-4da2-4fc4-ac57-a6d112888213",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9b741fad69cc6219b90142a4f3a46a45de0510680dd2fdf57a5402cd3a1e0176"
  },
  "id": "NARCxPg3jEuCsBaJ",
  "tags": []
}