{
  "name": "MSG SALUDO",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text-delay-calc",
              "name": "delay",
              "value": "={{ parseInt($('Saludo').item.json.output.length * 50) }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        600,
        -360
      ],
      "id": "6921f9e3-bdec-4b0c-836b-e453f9896033",
      "name": "Delay Text Saludo"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendText/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "text",
              "value": "={{ $('Saludo').item.json.output }}"
            },
            {
              "name": "delay",
              "value": "={{ $('Delay Text Saludo').item.json.delay }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        840,
        -360
      ],
      "id": "c8a1901f-0a52-43b1-9865-5a05ee49c563",
      "name": "Send Test Saludo"
    },
    {
      "parameters": {
        "jsCode": "// Obtener hora UTC y ajustarla a UTC-5\nconst ahora = new Date();\nconst horaUTC = ahora.getUTCHours();\nconst minutosUTC = ahora.getUTCMinutes();\nconst horaUTC5 = (horaUTC + 24 - 5) % 24;\n\n// Determinar saludo y emoji según hora (sin mostrar la hora al cliente)\nlet saludoHora = '';\nlet emoji = '';\n\nif (horaUTC5 >= 5 && horaUTC5 < 12) {\n  saludoHora = 'buenos días';\n  emoji = '☀️';\n} else if (horaUTC5 >= 12 && horaUTC5 < 19) {\n  saludoHora = 'buenas tardes';\n  emoji = '🌇';\n} else {\n  saludoHora = 'buenas noches';\n  emoji = '🌙';\n}\n\n// Arreglo de 10 mensajes con saludo dinámico (sin mostrar la hora)\nconst mensajes = [\n  `Hola, ${saludoHora} ${emoji} Un gusto saludarte. Mi nombre es Erica.  \nTe voy a compartir el catálogo 📒. ¿Tienes alguna fragancia en mente o deseas que te ayude a elegir?`,\n\n  `¡Hola! Muy ${saludoHora} 😊 Soy Erica.  \nEstoy por enviarte el catálogo, y con gusto te puedo asesorar si estás buscando algo en particular.`,\n\n  `${saludoHora.charAt(0).toUpperCase() + saludoHora.slice(1)} ${emoji} Mi nombre es Erica, encantada de atenderte.  \nTe compartiré el catálogo ahora. ¿Hay alguna fragancia específica que te interese o prefieres que te recomiende algo?`,\n\n  `Hola, un placer saludarte, ${saludoHora} 🌸 Soy Erica.  \nYa mismo te envío el catálogo. ¿Te gustaría ver algo en especial o prefieres que te asesore?`,\n\n  `¡Muy ${saludoHora}! 😊 Soy Erica y estaré encantada de ayudarte.  \nTe enviaré el catálogo. Si tienes alguna preferencia en aromas, no dudes en decírmelo.`,\n\n  `¡Hola! Te saludo con mucho cariño esta ${saludoHora} ${emoji}  \nSoy Erica. Te haré llegar el catálogo y si quieres una recomendación, estaré encantada de ayudarte.`,\n\n  `${saludoHora.charAt(0).toUpperCase() + saludoHora.slice(1)} ✨ Soy Erica y estoy lista para ayudarte.  \nTe comparto el catálogo. ¿Buscas algo en particular o deseas que te sugiera opciones?`,\n\n  `Hola, muy ${saludoHora} 🌺 Qué gusto saludarte. Mi nombre es Erica.  \nEn un momento te comparto el catálogo. ¿Hay algún aroma que prefieras o te gustaría asesoría?`,\n\n  `¡${saludoHora.charAt(0).toUpperCase() + saludoHora.slice(1)}! 🎉 Soy Erica.  \nYa te voy a compartir el catálogo. Si estás buscando un aroma especial, dime y con gusto te ayudo.`,\n\n  `Hola 😊 Te deseo un excelente ${saludoHora}.  \nSoy Erica. Enseguida te paso el catálogo. ¿Tienes alguna fragancia en mente o quieres que te recomiende una?`\n];\n\n// Seleccionar uno al azar\nconst mensajeFinal = mensajes[Math.floor(Math.random() * mensajes.length)];\n\n// Retornar para prueba\nreturn [\n  {\n    json: {\n      saludo: mensajeFinal\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1060,
        -360
      ],
      "id": "3ef37752-975c-49c8-b958-b5101aa421b9",
      "name": "Saludo Dinámico Hora"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text-delay-calc-2",
              "name": "delay",
              "value": "={{ parseInt($('Saludo Dinámico Hora').item.json.saludo.length * 50) }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1300,
        -360
      ],
      "id": "51fc33f8-fa30-4709-bf74-35300125d6f8",
      "name": "Delay Text Saludo 2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendText/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "text",
              "value": "={{ $('Saludo Dinámico Hora').item.json.saludo }}"
            },
            {
              "name": "delay",
              "value": "={{ $('Delay Text Saludo 2').item.json.delay }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        -360
      ],
      "id": "6bb052cb-98b0-4793-b26f-534208ae3005",
      "name": "Send Saludo Dinámico"
    },
    {
      "parameters": {
        "jsCode": "const saludos = [\n`🌸 ¡Hola! Gracias por escribir a *Ed Perfumería*  \nEstamos encantados de ayudarte a encontrar la fragancia ideal.\n\nPara brindarte una atención personalizada, cuéntanos:  \n- Tu nombre  \n- Ciudad desde donde nos contactas  \n- Fragancia o producto que deseas\n\n🎁 **Promociones disponibles:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \n¡Aprovecha esta oportunidad!`,\n\n`💬 ¡Bienvenido a *Ed Perfumería*!  \nGracias por elegirnos para tu próxima compra de perfumes.\n\nPor favor compártenos los siguientes datos:  \n- Nombre  \n- Ciudad  \n- Producto o fragancia que deseas\n\n🔥 **Ofertas de la semana:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \n¡Promociones por tiempo limitado!`,\n\n`🎉 ¡Hola! Qué gusto tenerte en *Ed Perfumería*  \nEstamos aquí para ayudarte a encontrar tu aroma perfecto.\n\nIndícanos por favor:  \n- Tu nombre  \n- Desde dónde nos escribes  \n- Qué producto o fragancia estás buscando\n\n💎 **Precios especiales de esta semana:**  \n1 x $60.000  \n2 x $100.000  \n3 x $120.000  \n6 x $210.000  \n¡No dejes pasar estas ofertas!`,\n\n`🌟 ¡Gracias por comunicarte con *Ed Perfumería*!  \nNos alegra poder atenderte 😊\n\nPara ayudarte de la mejor manera, cuéntanos:  \n- Tu nombre  \n- Ciudad o lugar  \n- Qué producto o fragancia te interesa\n\n🎀 **Promoción actual:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \n¡Fragancias increíbles a precios únicos!`,\n\n`🚀 ¡Hola y bienvenido a *Ed Perfumería*!  \nEs un placer atenderte hoy ✨\n\nAntes de continuar, compártenos por favor:  \n- Tu nombre  \n- Ciudad o municipio  \n- Producto o fragancia que deseas\n\n🎉 **Ofertas vigentes:**  \n1 unidad por $60.000  \n2 unidades por $100.000  \n3 unidades por $120.000  \n6 unidades por $210.000  \n¡Te van a encantar!`,\n\n`🙌 ¡Hola! Gracias por escribir a *Ed Perfumería*  \nEstamos encantados de atenderte. 💐\n\nPara ayudarte mejor, por favor compártenos:  \n- Tu nombre  \n- Desde dónde nos escribes  \n- Qué fragancia o producto te interesa\n\n🎁 **Promoción de la semana:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \n¡No dejes pasar estas ofertas!`,\n\n`👋 ¡Bienvenid@ a *Ed Perfumería*!  \nNos alegra recibir tu mensaje. 💖\n\nPara brindarte una atención personalizada, cuéntanos:  \n- Tu nombre  \n- Ciudad o municipio  \n- Producto o aroma que deseas\n\n💎 **Ofertas vigentes:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \n¡Aprovecha nuestros mejores precios!`,\n\n`✨ ¡Hola! Gracias por contactar a *Ed Perfumería*  \nNos alegra mucho tenerte por aquí 😊\n\nPara empezar, por favor dinos:  \n- Tu nombre  \n- Ciudad  \n- Qué fragancia estás buscando\n\n🔥 **Oferta especial:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \n¡Solo por tiempo limitado!`,\n\n`🌟 ¡Gracias por comunicarte con *Ed Perfumería*!  \nEstamos aquí para ayudarte a encontrar tu fragancia ideal. 🧴✨\n\nPara comenzar, por favor cuéntanos:  \n- ¿Cuál es tu nombre?  \n- ¿Desde qué ciudad nos escribes?  \n- ¿Qué producto te interesa?\n\n💥 **Promociones disponibles:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \n¡Te esperamos con las mejores ofertas!`,\n\n`🎉 ¡Bienvenido a *Ed Perfumería*!  \nGracias por escribirnos. Estamos listos para asesorarte.\n\nPor favor indícanos:  \n- Nombre  \n- Ciudad  \n- Producto o fragancia que te interesa  \n\n💎 **Ofertas actuales:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \n¡No te las pierdas!`\n];\n\n// Selecciona uno al azar\nconst saludoAleatorio = saludos[Math.floor(Math.random() * saludos.length)];\n\nreturn [\n  {\n    json: {\n      output: saludoAleatorio\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        380,
        -360
      ],
      "id": "4fffda86-b6ee-4567-a386-cd0d55d5ce43",
      "name": "Saludo"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "instance",
              "type": "any"
            },
            {
              "name": "sender_split_split",
              "type": "any"
            }
          ]
        }
      },
      "id": "1fa8da4b-efb3-455e-84b1-e46d5596b591",
      "typeVersion": 1.1,
      "name": "Start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        160,
        -360
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1z1N-NqCHW2PrC1_HJS01MP6geTL6Jf_S",
          "mode": "list",
          "cachedResultName": "catalogo masculino actualizado (50).pdf",
          "cachedResultUrl": "https://drive.google.com/file/d/1z1N-NqCHW2PrC1_HJS01MP6geTL6Jf_S/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1760,
        -420
      ],
      "id": "976a8f2b-1c40-4059-85a5-2a3e0f59793c",
      "name": "Download Hombre",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1sf7vcqR6USGi-b496e7kCshxMNwI-4c4",
          "mode": "list",
          "cachedResultName": "catalogo femenino actualizado (55).pdf",
          "cachedResultUrl": "https://drive.google.com/file/d/1sf7vcqR6USGi-b496e7kCshxMNwI-4c4/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1760,
        -280
      ],
      "id": "42c4d305-5f9a-46da-a4d9-8521e742698a",
      "name": "Download Mujer",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendMedia/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "mediatype",
              "value": "=document"
            },
            {
              "name": "fileName",
              "value": "Catálogo Ed Perfumería Mujer.pdf"
            },
            {
              "name": "media",
              "value": "={{ $('Download Mujer').item.binary.data.data }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1960,
        -280
      ],
      "id": "ea01aacf-85b9-45ea-9a8c-ac6c91250830",
      "name": "Send PDF Catalog Mujer"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendMedia/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "mediatype",
              "value": "=document"
            },
            {
              "name": "fileName",
              "value": "Catálogo Ed Perfumería Hombres.pdf"
            },
            {
              "name": "media",
              "value": "={{ $('Download Hombre').item.binary.data.data }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1960,
        -420
      ],
      "id": "96d50e24-4f02-416e-9e19-0f9c6ca222db",
      "name": "Send PDF Catalog Hombre"
    }
  ],
  "pinData": {},
  "connections": {
    "Saludo": {
      "main": [
        [
          {
            "node": "Delay Text Saludo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delay Text Saludo": {
      "main": [
        [
          {
            "node": "Send Test Saludo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Test Saludo": {
      "main": [
        [
          {
            "node": "Saludo Dinámico Hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saludo Dinámico Hora": {
      "main": [
        [
          {
            "node": "Delay Text Saludo 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delay Text Saludo 2": {
      "main": [
        [
          {
            "node": "Send Saludo Dinámico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start": {
      "main": [
        [
          {
            "node": "Saludo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Saludo Dinámico": {
      "main": [
        [
          {
            "node": "Download Hombre",
            "type": "main",
            "index": 0
          },
          {
            "node": "Download Mujer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Hombre": {
      "main": [
        [
          {
            "node": "Send PDF Catalog Hombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Mujer": {
      "main": [
        [
          {
            "node": "Send PDF Catalog Mujer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2a096a87-2d6c-4636-8a6e-0bce408cf314",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9b741fad69cc6219b90142a4f3a46a45de0510680dd2fdf57a5402cd3a1e0176"
  },
  "id": "wnJkCuOu9EpHlbIk",
  "tags": [
    {
      "createdAt": "2025-07-08T23:54:46.199Z",
      "updatedAt": "2025-07-08T23:54:46.199Z",
      "id": "WtlktAsOhSBmH0bF",
      "name": "EDPERFUMERIA"
    }
  ]
}