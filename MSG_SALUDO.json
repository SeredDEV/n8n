{
  "name": "MSG SALUDO",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text-delay-calc",
              "name": "delay",
              "value": "={{ parseInt($('Saludo').item.json.output.length * 50) }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        600,
        -360
      ],
      "id": "6921f9e3-bdec-4b0c-836b-e453f9896033",
      "name": "Delay Text Saludo"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendText/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "text",
              "value": "={{ $('Saludo').item.json.output }}"
            },
            {
              "name": "delay",
              "value": "={{ $('Delay Text Saludo').item.json.delay }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        840,
        -360
      ],
      "id": "c8a1901f-0a52-43b1-9865-5a05ee49c563",
      "name": "Send Test Saludo"
    },
    {
      "parameters": {
        "jsCode": "// Obtener hora UTC y ajustarla a UTC-5\nconst ahora = new Date();\nconst horaUTC = ahora.getUTCHours();\nconst minutosUTC = ahora.getUTCMinutes();\nconst horaUTC5 = (horaUTC + 24 - 5) % 24;\n\n// Determinar saludo y emoji segÃºn hora (sin mostrar la hora al cliente)\nlet saludoHora = '';\nlet emoji = '';\n\nif (horaUTC5 >= 5 && horaUTC5 < 12) {\n  saludoHora = 'buenos dÃ­as';\n  emoji = 'â˜€ï¸';\n} else if (horaUTC5 >= 12 && horaUTC5 < 19) {\n  saludoHora = 'buenas tardes';\n  emoji = 'ðŸŒ‡';\n} else {\n  saludoHora = 'buenas noches';\n  emoji = 'ðŸŒ™';\n}\n\n// Arreglo de 10 mensajes con saludo dinÃ¡mico (sin mostrar la hora)\nconst mensajes = [\n  `Hola, ${saludoHora} ${emoji} Un gusto saludarte. Mi nombre es Erica.  \nTe voy a compartir el catÃ¡logo ðŸ“’. Â¿Tienes alguna fragancia en mente o deseas que te ayude a elegir?`,\n\n  `Â¡Hola! Muy ${saludoHora} ðŸ˜Š Soy Erica.  \nEstoy por enviarte el catÃ¡logo, y con gusto te puedo asesorar si estÃ¡s buscando algo en particular.`,\n\n  `${saludoHora.charAt(0).toUpperCase() + saludoHora.slice(1)} ${emoji} Mi nombre es Erica, encantada de atenderte.  \nTe compartirÃ© el catÃ¡logo ahora. Â¿Hay alguna fragancia especÃ­fica que te interese o prefieres que te recomiende algo?`,\n\n  `Hola, un placer saludarte, ${saludoHora} ðŸŒ¸ Soy Erica.  \nYa mismo te envÃ­o el catÃ¡logo. Â¿Te gustarÃ­a ver algo en especial o prefieres que te asesore?`,\n\n  `Â¡Muy ${saludoHora}! ðŸ˜Š Soy Erica y estarÃ© encantada de ayudarte.  \nTe enviarÃ© el catÃ¡logo. Si tienes alguna preferencia en aromas, no dudes en decÃ­rmelo.`,\n\n  `Â¡Hola! Te saludo con mucho cariÃ±o esta ${saludoHora} ${emoji}  \nSoy Erica. Te harÃ© llegar el catÃ¡logo y si quieres una recomendaciÃ³n, estarÃ© encantada de ayudarte.`,\n\n  `${saludoHora.charAt(0).toUpperCase() + saludoHora.slice(1)} âœ¨ Soy Erica y estoy lista para ayudarte.  \nTe comparto el catÃ¡logo. Â¿Buscas algo en particular o deseas que te sugiera opciones?`,\n\n  `Hola, muy ${saludoHora} ðŸŒº QuÃ© gusto saludarte. Mi nombre es Erica.  \nEn un momento te comparto el catÃ¡logo. Â¿Hay algÃºn aroma que prefieras o te gustarÃ­a asesorÃ­a?`,\n\n  `Â¡${saludoHora.charAt(0).toUpperCase() + saludoHora.slice(1)}! ðŸŽ‰ Soy Erica.  \nYa te voy a compartir el catÃ¡logo. Si estÃ¡s buscando un aroma especial, dime y con gusto te ayudo.`,\n\n  `Hola ðŸ˜Š Te deseo un excelente ${saludoHora}.  \nSoy Erica. Enseguida te paso el catÃ¡logo. Â¿Tienes alguna fragancia en mente o quieres que te recomiende una?`\n];\n\n// Seleccionar uno al azar\nconst mensajeFinal = mensajes[Math.floor(Math.random() * mensajes.length)];\n\n// Retornar para prueba\nreturn [\n  {\n    json: {\n      saludo: mensajeFinal\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1060,
        -360
      ],
      "id": "3ef37752-975c-49c8-b958-b5101aa421b9",
      "name": "Saludo DinÃ¡mico Hora"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text-delay-calc-2",
              "name": "delay",
              "value": "={{ parseInt($('Saludo DinÃ¡mico Hora').item.json.saludo.length * 50) }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1300,
        -360
      ],
      "id": "51fc33f8-fa30-4709-bf74-35300125d6f8",
      "name": "Delay Text Saludo 2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendText/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "text",
              "value": "={{ $('Saludo DinÃ¡mico Hora').item.json.saludo }}"
            },
            {
              "name": "delay",
              "value": "={{ $('Delay Text Saludo 2').item.json.delay }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        -360
      ],
      "id": "6bb052cb-98b0-4793-b26f-534208ae3005",
      "name": "Send Saludo DinÃ¡mico"
    },
    {
      "parameters": {
        "jsCode": "const saludos = [\n`ðŸŒ¸ Â¡Hola! Gracias por escribir a *Ed PerfumerÃ­a*  \nEstamos encantados de ayudarte a encontrar la fragancia ideal.\n\nPara brindarte una atenciÃ³n personalizada, cuÃ©ntanos:  \n- Tu nombre  \n- Ciudad desde donde nos contactas  \n- Fragancia o producto que deseas\n\nðŸŽ **Promociones disponibles:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \nÂ¡Aprovecha esta oportunidad!`,\n\n`ðŸ’¬ Â¡Bienvenido a *Ed PerfumerÃ­a*!  \nGracias por elegirnos para tu prÃ³xima compra de perfumes.\n\nPor favor compÃ¡rtenos los siguientes datos:  \n- Nombre  \n- Ciudad  \n- Producto o fragancia que deseas\n\nðŸ”¥ **Ofertas de la semana:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \nÂ¡Promociones por tiempo limitado!`,\n\n`ðŸŽ‰ Â¡Hola! QuÃ© gusto tenerte en *Ed PerfumerÃ­a*  \nEstamos aquÃ­ para ayudarte a encontrar tu aroma perfecto.\n\nIndÃ­canos por favor:  \n- Tu nombre  \n- Desde dÃ³nde nos escribes  \n- QuÃ© producto o fragancia estÃ¡s buscando\n\nðŸ’Ž **Precios especiales de esta semana:**  \n1 x $60.000  \n2 x $100.000  \n3 x $120.000  \n6 x $210.000  \nÂ¡No dejes pasar estas ofertas!`,\n\n`ðŸŒŸ Â¡Gracias por comunicarte con *Ed PerfumerÃ­a*!  \nNos alegra poder atenderte ðŸ˜Š\n\nPara ayudarte de la mejor manera, cuÃ©ntanos:  \n- Tu nombre  \n- Ciudad o lugar  \n- QuÃ© producto o fragancia te interesa\n\nðŸŽ€ **PromociÃ³n actual:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \nÂ¡Fragancias increÃ­bles a precios Ãºnicos!`,\n\n`ðŸš€ Â¡Hola y bienvenido a *Ed PerfumerÃ­a*!  \nEs un placer atenderte hoy âœ¨\n\nAntes de continuar, compÃ¡rtenos por favor:  \n- Tu nombre  \n- Ciudad o municipio  \n- Producto o fragancia que deseas\n\nðŸŽ‰ **Ofertas vigentes:**  \n1 unidad por $60.000  \n2 unidades por $100.000  \n3 unidades por $120.000  \n6 unidades por $210.000  \nÂ¡Te van a encantar!`,\n\n`ðŸ™Œ Â¡Hola! Gracias por escribir a *Ed PerfumerÃ­a*  \nEstamos encantados de atenderte. ðŸ’\n\nPara ayudarte mejor, por favor compÃ¡rtenos:  \n- Tu nombre  \n- Desde dÃ³nde nos escribes  \n- QuÃ© fragancia o producto te interesa\n\nðŸŽ **PromociÃ³n de la semana:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \nÂ¡No dejes pasar estas ofertas!`,\n\n`ðŸ‘‹ Â¡Bienvenid@ a *Ed PerfumerÃ­a*!  \nNos alegra recibir tu mensaje. ðŸ’–\n\nPara brindarte una atenciÃ³n personalizada, cuÃ©ntanos:  \n- Tu nombre  \n- Ciudad o municipio  \n- Producto o aroma que deseas\n\nðŸ’Ž **Ofertas vigentes:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \nÂ¡Aprovecha nuestros mejores precios!`,\n\n`âœ¨ Â¡Hola! Gracias por contactar a *Ed PerfumerÃ­a*  \nNos alegra mucho tenerte por aquÃ­ ðŸ˜Š\n\nPara empezar, por favor dinos:  \n- Tu nombre  \n- Ciudad  \n- QuÃ© fragancia estÃ¡s buscando\n\nðŸ”¥ **Oferta especial:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \nÂ¡Solo por tiempo limitado!`,\n\n`ðŸŒŸ Â¡Gracias por comunicarte con *Ed PerfumerÃ­a*!  \nEstamos aquÃ­ para ayudarte a encontrar tu fragancia ideal. ðŸ§´âœ¨\n\nPara comenzar, por favor cuÃ©ntanos:  \n- Â¿CuÃ¡l es tu nombre?  \n- Â¿Desde quÃ© ciudad nos escribes?  \n- Â¿QuÃ© producto te interesa?\n\nðŸ’¥ **Promociones disponibles:**  \n1 por $60.000  \n2 por $100.000  \n3 por $120.000  \n6 por $210.000  \nÂ¡Te esperamos con las mejores ofertas!`,\n\n`ðŸŽ‰ Â¡Bienvenido a *Ed PerfumerÃ­a*!  \nGracias por escribirnos. Estamos listos para asesorarte.\n\nPor favor indÃ­canos:  \n- Nombre  \n- Ciudad  \n- Producto o fragancia que te interesa  \n\nðŸ’Ž **Ofertas actuales:**  \n1 unidad: $60.000  \n2 unidades: $100.000  \n3 unidades: $120.000  \n6 unidades: $210.000  \nÂ¡No te las pierdas!`\n];\n\n// Selecciona uno al azar\nconst saludoAleatorio = saludos[Math.floor(Math.random() * saludos.length)];\n\nreturn [\n  {\n    json: {\n      output: saludoAleatorio\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        380,
        -360
      ],
      "id": "4fffda86-b6ee-4567-a386-cd0d55d5ce43",
      "name": "Saludo"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "instance",
              "type": "any"
            },
            {
              "name": "sender_split_split",
              "type": "any"
            }
          ]
        }
      },
      "id": "1fa8da4b-efb3-455e-84b1-e46d5596b591",
      "typeVersion": 1.1,
      "name": "Start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        160,
        -360
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1z1N-NqCHW2PrC1_HJS01MP6geTL6Jf_S",
          "mode": "list",
          "cachedResultName": "catalogo masculino actualizado (50).pdf",
          "cachedResultUrl": "https://drive.google.com/file/d/1z1N-NqCHW2PrC1_HJS01MP6geTL6Jf_S/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1760,
        -420
      ],
      "id": "976a8f2b-1c40-4059-85a5-2a3e0f59793c",
      "name": "Download Hombre",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1sf7vcqR6USGi-b496e7kCshxMNwI-4c4",
          "mode": "list",
          "cachedResultName": "catalogo femenino actualizado (55).pdf",
          "cachedResultUrl": "https://drive.google.com/file/d/1sf7vcqR6USGi-b496e7kCshxMNwI-4c4/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1760,
        -280
      ],
      "id": "42c4d305-5f9a-46da-a4d9-8521e742698a",
      "name": "Download Mujer",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lZPZd6pI3LpqZuri",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendMedia/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "mediatype",
              "value": "=document"
            },
            {
              "name": "fileName",
              "value": "CatÃ¡logo Ed PerfumerÃ­a Mujer.pdf"
            },
            {
              "name": "media",
              "value": "={{ $('Download Mujer').item.binary.data.data }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1960,
        -280
      ],
      "id": "ea01aacf-85b9-45ea-9a8c-ac6c91250830",
      "name": "Send PDF Catalog Mujer"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://31.97.149.15:8080/message/sendMedia/{{ $('Start').item.json.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "123456.+az1"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Start').item.json.sender_split_split.split('@')[0] }}"
            },
            {
              "name": "mediatype",
              "value": "=document"
            },
            {
              "name": "fileName",
              "value": "CatÃ¡logo Ed PerfumerÃ­a Hombres.pdf"
            },
            {
              "name": "media",
              "value": "={{ $('Download Hombre').item.binary.data.data }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1960,
        -420
      ],
      "id": "96d50e24-4f02-416e-9e19-0f9c6ca222db",
      "name": "Send PDF Catalog Hombre"
    }
  ],
  "pinData": {},
  "connections": {
    "Saludo": {
      "main": [
        [
          {
            "node": "Delay Text Saludo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delay Text Saludo": {
      "main": [
        [
          {
            "node": "Send Test Saludo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Test Saludo": {
      "main": [
        [
          {
            "node": "Saludo DinÃ¡mico Hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saludo DinÃ¡mico Hora": {
      "main": [
        [
          {
            "node": "Delay Text Saludo 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delay Text Saludo 2": {
      "main": [
        [
          {
            "node": "Send Saludo DinÃ¡mico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start": {
      "main": [
        [
          {
            "node": "Saludo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Saludo DinÃ¡mico": {
      "main": [
        [
          {
            "node": "Download Hombre",
            "type": "main",
            "index": 0
          },
          {
            "node": "Download Mujer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Hombre": {
      "main": [
        [
          {
            "node": "Send PDF Catalog Hombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Mujer": {
      "main": [
        [
          {
            "node": "Send PDF Catalog Mujer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2a096a87-2d6c-4636-8a6e-0bce408cf314",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9b741fad69cc6219b90142a4f3a46a45de0510680dd2fdf57a5402cd3a1e0176"
  },
  "id": "wnJkCuOu9EpHlbIk",
  "tags": [
    {
      "createdAt": "2025-07-08T23:54:46.199Z",
      "updatedAt": "2025-07-08T23:54:46.199Z",
      "id": "WtlktAsOhSBmH0bF",
      "name": "EDPERFUMERIA"
    }
  ]
}